<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>STAT 340: Data Science II - 34&nbsp; Bootstrapping</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./bootstrap_practice.html" rel="next">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./bootstrap.html">Bootstrapping</a></li><li class="breadcrumb-item"><a href="./bootstrap.html"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">Bootstrapping</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">STAT 340: Data Science II</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">STAT 340 Index</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false">
 <span class="menu-text">Sampling</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rv.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Random Variables</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./R01_RandomVariables.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Random Variables R Examples</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rv_practice.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Probability and Random Variables Practice</span></span></a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./cov.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Independence, Conditional Probability and Bayes’ Rule</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./R02_IndepCondBayes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Independence, Conditional Probability and Bayes Theorem R Examples</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./cov_practice.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Independence and Conditional Probability Practice</span></span></a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Monte Carlo</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./R03_MonteCarloExamples.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Monte Carlo Examples</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mc_practice.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Monte Carlo Practice</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./R_MonteCarlo_Battleship.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Monte Carlo Battleship</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false">
 <span class="menu-text">Testing</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./testing1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Introduction to Statistical Testing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./R04_Monte_Carlo_Testing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Monte Carlo Testing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./testing1_practice.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Monte Carlo Testing Practice</span></span></a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./testing2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Statistical Testing, Continued</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./R05_testing_Additional_Examples.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Monte Carlo Testing: Additional Examples</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./testing2_practice.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Testing and Power Practice</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">
 <span class="menu-text">Estimation</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./estimation1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Estimation Part 1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./estimation1_practice.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Point Estimation Practice</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./R06_More_Estimation_Examples.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Estimation Examples</span></span></a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./estimation2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Estimation Part 2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./estimation2_practice.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Interval Estimation Practice</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./R07_More_Estimation_and_CI_Examples.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Interval Estimation Examples</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false">
 <span class="menu-text">Prediction</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./prediction1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Prediction (Simple Linear Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./slr_practice.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Simple Linear Regression Practice</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./R08_prediction_examples.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Simple Linear Regression - Examples</span></span></a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./prediction2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Prediction (Multiple Linear Regression)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mlr_practice.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Multiple Linear Regression Practice</span></span></a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./logistic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Logistic Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./logistic_practice.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">Logistic Regression Practice</span></span></a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./cv.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">Model Selection and Cross Validation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./cv_practice.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">Cross Validation Practice</span></span></a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Bootstrapping</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bootstrap.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">Bootstrapping</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bootstrap_practice.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">35</span>&nbsp; <span class="chapter-title">Bootstrap Practice</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="false">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./RV_summary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Random Variable Summary</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#learning-objectives" id="toc-learning-objectives" class="nav-link active" data-scroll-target="#learning-objectives"><span class="header-section-number">34.1</span> Learning objectives</a></li>
  <li><a href="#estimating-variance" id="toc-estimating-variance" class="nav-link" data-scroll-target="#estimating-variance"><span class="header-section-number">34.2</span> Estimating Variance</a>
  <ul class="collapse">
  <li><a href="#tricky-variance-computations" id="toc-tricky-variance-computations" class="nav-link" data-scroll-target="#tricky-variance-computations"><span class="header-section-number">34.2.1</span> Tricky variance computations</a></li>
  </ul></li>
  <li><a href="#refresher-simulation-based-methods" id="toc-refresher-simulation-based-methods" class="nav-link" data-scroll-target="#refresher-simulation-based-methods"><span class="header-section-number">34.3</span> Refresher: simulation-based methods</a></li>
  <li><a href="#what-if-we-dont-have-a-model" id="toc-what-if-we-dont-have-a-model" class="nav-link" data-scroll-target="#what-if-we-dont-have-a-model"><span class="header-section-number">34.4</span> What if we don’t have a model?</a></li>
  <li><a href="#introducing-the-bootstrap" id="toc-introducing-the-bootstrap" class="nav-link" data-scroll-target="#introducing-the-bootstrap"><span class="header-section-number">34.5</span> Introducing the Bootstrap</a>
  <ul class="collapse">
  <li><a href="#wait-how-can-this-possibly-work" id="toc-wait-how-can-this-possibly-work" class="nav-link" data-scroll-target="#wait-how-can-this-possibly-work"><span class="header-section-number">34.5.1</span> Wait, how can this possibly work?!</a></li>
  <li><a href="#example-estimating-the-poisson-rate-parameter" id="toc-example-estimating-the-poisson-rate-parameter" class="nav-link" data-scroll-target="#example-estimating-the-poisson-rate-parameter"><span class="header-section-number">34.5.2</span> Example: estimating the Poisson rate parameter</a></li>
  <li><a href="#recap-general-recipe-for-the-bootstrap" id="toc-recap-general-recipe-for-the-bootstrap" class="nav-link" data-scroll-target="#recap-general-recipe-for-the-bootstrap"><span class="header-section-number">34.5.3</span> Recap: general recipe for the bootstrap</a></li>
  </ul></li>
  <li><a href="#bootstrapping-for-more-complicated-statistics" id="toc-bootstrapping-for-more-complicated-statistics" class="nav-link" data-scroll-target="#bootstrapping-for-more-complicated-statistics"><span class="header-section-number">34.6</span> Bootstrapping for more complicated statistics</a>
  <ul class="collapse">
  <li><a href="#demo-applying-the-bootstrap-to-financial-data" id="toc-demo-applying-the-bootstrap-to-financial-data" class="nav-link" data-scroll-target="#demo-applying-the-bootstrap-to-financial-data"><span class="header-section-number">34.6.1</span> Demo: applying the bootstrap to financial data</a></li>
  </ul></li>
  <li><a href="#limitations-and-extensions-of-the-bootstrap" id="toc-limitations-and-extensions-of-the-bootstrap" class="nav-link" data-scroll-target="#limitations-and-extensions-of-the-bootstrap"><span class="header-section-number">34.7</span> Limitations and extensions of the bootstrap</a>
  <ul class="collapse">
  <li><a href="#example-estimating-the-distribution-of-the-maximum" id="toc-example-estimating-the-distribution-of-the-maximum" class="nav-link" data-scroll-target="#example-estimating-the-distribution-of-the-maximum"><span class="header-section-number">34.7.1</span> Example: estimating the distribution of the maximum</a></li>
  <li><a href="#a-cautionary-tale" id="toc-a-cautionary-tale" class="nav-link" data-scroll-target="#a-cautionary-tale"><span class="header-section-number">34.7.2</span> A cautionary tale</a></li>
  </ul></li>
  <li><a href="#review" id="toc-review" class="nav-link" data-scroll-target="#review"><span class="header-section-number">34.8</span> Review</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">Bootstrapping</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p><strong>Readings:</strong> ISLR Section 5.2</p>
<p>In previous lectures throughout the semester, we have looked at different ways of quantifying uncertainty in our data and our resulting estimates. Among the most fundamental tools in statistics for quantifying uncertainty is the bootstrap. Ultimately, the bootstrap amounts to resampling our data as though it were the population itself. Rather surprisingly, this can actually help us estimate certain quantities related to variances (i.e., uncertainty).</p>
<section id="learning-objectives" class="level2" data-number="34.1">
<h2 data-number="34.1" class="anchored" data-anchor-id="learning-objectives"><span class="header-section-number">34.1</span> Learning objectives</h2>
<p>After this lecture, you will be able to</p>
<ul>
<li>Explain the bootstrap and its applicability.</li>
<li>Implement and apply the bootstrap to estimate variance in simple models.</li>
</ul>
</section>
<section id="estimating-variance" class="level2" data-number="34.2">
<h2 data-number="34.2" class="anchored" data-anchor-id="estimating-variance"><span class="header-section-number">34.2</span> Estimating Variance</h2>
<p>In a wide range of applications, we need to estimate the variance of our data.</p>
<p><strong>Example: confidence intervals</strong></p>
<p>Given data <span class="math inline">\(X_1,X_2,\dots,X_n\)</span> drawn from some distribution, we are often interested in constructing a confidence interval for some parameter <span class="math inline">\(\theta\)</span>. For example, <span class="math inline">\(\theta\)</span> might be the mean of our distribution. If an estimator <span class="math inline">\(\hat{\theta}\)</span> is approximately normal about <span class="math inline">\(\theta\)</span>, we could construct an approximate CI for <span class="math inline">\(\theta\)</span> if only we knew the standard deviation of <span class="math inline">\(\hat{\theta}\)</span>, <span class="math display">\[
\sigma_{\hat{\theta}} = \sqrt{ \operatorname{Var} \hat{\theta} }.
\]</span> We have seen in our lectures on estimation and confidence intervals that there are ways to estimate this variance, but sometimes it is a lot more complicated (e.g., more computationally expensive or more mathematically complicated).</p>
<p><strong>Example: errors in linear regression</strong></p>
<p>Recall that in linear regression we observe <span class="math inline">\((X_i,Y_i)\)</span> pairs where <span class="math display">\[
Y_i = \beta_0 + \beta_1 X_i + \epsilon_i,~~~i=1,2,\dots,n
\]</span> where <span class="math inline">\(\epsilon_1,\epsilon_2,\dots,\epsilon_n\)</span> are drawn iid according to a normal with mean zero and unknown variance <span class="math inline">\(\sigma^2 &gt; 0\)</span>.</p>
<p>During our discussions of linear regression in the last few weeks, we saw situations where we were interested in the sampling distribution of the estimated coefficients <span class="math inline">\(\hat{\beta}_0, \hat{\beta}_1\)</span> (e.g., in adjusted <span class="math inline">\(R^2\)</span> or in interpreting the p-values associated to different coefficients). Often, we need to know <span class="math inline">\(\sigma^2\)</span> or at least have a good estimate of it. How might we estimate <span class="math inline">\(\sigma^2\)</span>?</p>
<section id="tricky-variance-computations" class="level3" data-number="34.2.1">
<h3 data-number="34.2.1" class="anchored" data-anchor-id="tricky-variance-computations"><span class="header-section-number">34.2.1</span> Tricky variance computations</h3>
<p>In situations like the above, we had central limit theorems or similar results that allowed us to estimate the variance of the quantities we cared about. Unfortunately, this isn’t always the case. Here’s a simple example, adapted from ISLR (beginning of Section 5.2):</p>
<p><strong>Example: allocating investments</strong></p>
<p>Suppose that we have two different stocks we can invest in, which yield returns <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>. So, we invest a single dollar (just to keep things simple!), and we need to split between these two different stocks. Let’s say we put <span class="math inline">\(\alpha\)</span> dollars into the first stock (with return <span class="math inline">\(X\)</span>) and <span class="math inline">\(1-\alpha\)</span> (i.e., the rest) into the second stock (with return <span class="math inline">\(Y\)</span>).</p>
<p>Then we get back an amount <span class="math inline">\(\alpha X+ (1-\alpha) Y\)</span>.</p>
<p>Now, this amount of money that we get back on our investment is random, because it is based on the (random) stock yields <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>. An obvious thing to do is to try and maximize this, but this can result in us making risky bets.</p>
<p>Most investment strategies instead aim to minimize the “risk” (note: in statistics, <em>risk</em> means something very different from this– this is the “finance” meaning of the term “risk”): <span class="math display">\[
\begin{aligned}
  \operatorname{Var}\left( \alpha X + (1-\alpha) Y \right)
  &amp;= \alpha^2 \operatorname{Var} X
      + (1-\alpha)^2 \operatorname{Var} Y
      + 2\alpha(1-\alpha) \operatorname{Cov}(X,Y) \\
  &amp;= \alpha^2 \sigma_X^2
    + (1-\alpha)^2 \sigma_Y^2
    + 2\alpha(1-\alpha) \sigma_{XY}
    \end{aligned}
\]</span> Where <span class="math display">\[
\begin{aligned}
\sigma_X^2 &amp;= \operatorname{Var} X \\
\sigma_Y^2 &amp;= \operatorname{Var} Y \\
\sigma_{XY} &amp;= \operatorname{Cov}( X, Y ).
\end{aligned}
\]</span> One can prove that <span class="math inline">\(\operatorname{Var}\left( \alpha X + (1-\alpha) Y \right)\)</span> is minimized by taking <span class="math display">\[
\alpha = \frac{ \sigma_Y^2 - \sigma_{XY} }{ \sigma_X^2 + \sigma_Y^2 -2\sigma_{XY} }.
\]</span> Unfortunately, we don’t know the variance and covariance terms (i.e., <span class="math inline">\(\sigma_X^2\)</span>, <span class="math inline">\(\sigma_Y^2\)</span>, <span class="math inline">\(\sigma_{XY}\)</span>)…</p>
<p>But suppose we have observations <span class="math inline">\((X_i,Y_i)\)</span>, <span class="math inline">\(i=1,2,\dots,n\)</span> of, say, the performance of these two stocks on prior days. We could use this data to estimate <span class="math inline">\(\sigma_X^2\)</span>, <span class="math inline">\(\sigma_Y^2\)</span> and <span class="math inline">\(\sigma_{XY}\)</span>.</p>
<p>If we denote the estimates <span class="math inline">\(\hat{\sigma}_X^2\)</span>, <span class="math inline">\(\hat{\sigma}_Y^2\)</span> and <span class="math inline">\(\hat{\sigma}_{XY}\)</span>, then we could plug these into the above equation and obtain an estimator for <span class="math inline">\(\alpha\)</span>, <span class="math display">\[
\hat{\alpha}
= \frac{ \hat{\sigma}_Y^2 - \hat{\sigma}_{XY} }
        { \hat{\sigma}_X^2 + \hat{\sigma}_Y^2 -2\hat{\sigma}_{XY} }.
\]</span></p>
<p>Now, here’s where things get tricky. What if we want to quantify our uncertainty about <span class="math inline">\(\alpha\)</span>?</p>
<p>After all, <span class="math inline">\(\hat{\alpha}\)</span> is a function of the (random) data, so it is itself a random variable, and it is reasonable to ask about, for example, its variance.</p>
<p>But <span class="math inline">\(\hat{\alpha}\)</span> depends on the data <span class="math inline">\(\{ (X_i,Y_i) : i=1,2,\dots,n \}\)</span> in a fairly complicated way, so it’s not obvious what <span class="math inline">\(\operatorname{Var} \hat{ \alpha}\)</span> should actually be.</p>
</section>
</section>
<section id="refresher-simulation-based-methods" class="level2" data-number="34.3">
<h2 data-number="34.3" class="anchored" data-anchor-id="refresher-simulation-based-methods"><span class="header-section-number">34.3</span> Refresher: simulation-based methods</h2>
<p>In our discussion of estimation and confidence intervals earlier in the semester, we obtained simulation-based confidence intervals by</p>
<ol type="1">
<li>Assuming a model for our data (e.g., assuming the data came from a Poisson distribution)</li>
<li>Estimating the parameter(s) of that model from the data (e.g., estimating <span class="math inline">\(\lambda\)</span> under the Poisson)</li>
<li>Generating new random samples from the model with the estimated parameter(s) (e.g., drawing from <span class="math inline">\(\operatorname{Pois}(\hat{\lambda})\)</span>)</li>
<li>Using these “fake” data samples to approximate the sampling distribution of our statistic of interest (e.g., <span class="math inline">\(\hat{\lambda}(X_1,X_2,\dots,X_n)\)</span>).</li>
</ol>
<p>If we had a model for our <span class="math inline">\((X_i,Y_i)\)</span> pairs, we could use the observed pairs to estimate the parameter(s) of that model and generate new samples <span class="math inline">\((X'_i,Y'_i), i=1,2,\dots,n\)</span> and compute <span class="math display">\[
\hat{\alpha}' =
\hat{\alpha}\left( (X'_1,Y'_1),(X'_2,Y'_2),\dots,(X'_n,Y'_n) \right).
\]</span> Doing this many times, we would get multiple random variables that approximate the distribution of <span class="math inline">\(\hat{\alpha}\)</span> (i.e., the statistic computed on our original data).</p>
</section>
<section id="what-if-we-dont-have-a-model" class="level2" data-number="34.4">
<h2 data-number="34.4" class="anchored" data-anchor-id="what-if-we-dont-have-a-model"><span class="header-section-number">34.4</span> What if we don’t have a model?</h2>
<p>Simulation-based approaches like the one discussed above work because we have made a model assumption about our data. If we assumed our data came from a Poisson distribution, then we could just estimate the Poisson parameters and generate new samples.</p>
<p>But often we don’t want to make such assumptions about our data. Because, for example</p>
<ul>
<li>Our parameter(s) may be expensive to estimate</li>
<li>The distribution may be expensive to draw from</li>
<li>We don’t want to make model assumptions in the first place!</li>
</ul>
<p>This last concern gives rise to what we call <em>non-parametric statistics</em>. That is, doing statistics while avoiding assumptions of the form “We assume that the data are generated according to a normal (or Poisson or Binomial or…)”.</p>
<p>The details of non-parametric statistics will have to wait for your later courses, but these concerns lead us to try and come up with a different way to “resample” copies of our statistic.</p>
</section>
<section id="introducing-the-bootstrap" class="level2" data-number="34.5">
<h2 data-number="34.5" class="anchored" data-anchor-id="introducing-the-bootstrap"><span class="header-section-number">34.5</span> Introducing the Bootstrap</h2>
<p>So, let’s try something a little weird.</p>
<p>What we want to do is to draw new samples from the same population (i.e., distribution) as our data came from. In the simulation-based approach, we estimate the parameter(s) to get an approximation to that true distribution.</p>
<p>The bootstrap takes a different tack. The data, <span class="math inline">\(X_1,X_2,\dots,X_n\)</span> is a sample from the <em>actual</em> population that we care about (i.e., not an approximation!). The bootstrap says, “let’s just sample from <span class="math inline">\(X_1,X_2,\dots,X_n\)</span>.”</p>
<p>Said another way, in the bootstrap, we sample <em>with replacement</em> from the observed data <span class="math display">\[
X_1, X_2, \dots, X_n,
\]</span> obtaining the sample <span class="math display">\[
X^*_1, X^*_2, \dots, X^*_n.
\]</span> The <span class="math inline">\(X^*_i\)</span> notation is convention in statistics– the asterisk (<span class="math inline">\(*\)</span>) denotes that the variable is resampled from the original data.</p>
<p><strong>Important note:</strong> <span class="math inline">\(X^*_i\)</span> does <em>not</em> necessarily equal <span class="math inline">\(X_i\)</span>. It is just the <span class="math inline">\(i\)</span>-th resampled data point. <span class="math inline">\(X^*_i\)</span> is equal to <em>some</em> <span class="math inline">\(X_j\)</span>, <span class="math inline">\(j=1,2,\dots,n\)</span>, with each of the <span class="math inline">\(n\)</span> different data points being equally likely. Each <span class="math inline">\(X_i^*\)</span> is a sample with replacement from the data <span class="math inline">\(X_1,X_2,\dots,X_n\)</span>.</p>
<p>Now, having resampled our data, we can compute our estimator on the bootstrap sample <span class="math inline">\(X^*_1,X^*_2,\dots,X^*_n\)</span>, say, <span class="math display">\[
\hat{\theta}\left(X^*_1,X^*_2,\dots,X^*_n \right).
\]</span> Repeating this many times (say, <span class="math inline">\(B\)</span> times), we can use these resampled replicates of our original estimator, say <span class="math display">\[
\hat{\theta}_1, \hat{\theta}_2, \dots, \hat{\theta}_B.
\]</span> The intuition is that these <span class="math inline">\(B\)</span> random variables, each based on a sample with replacement from the original data, are a good approximation to the true distribution of our estimate <span class="math inline">\(\hat{\theta}(X_1,X_2,\dots,X_n)\)</span>, and we can use them to do things like estimating the variance.</p>
<section id="wait-how-can-this-possibly-work" class="level3" data-number="34.5.1">
<h3 data-number="34.5.1" class="anchored" data-anchor-id="wait-how-can-this-possibly-work"><span class="header-section-number">34.5.1</span> Wait, how can this possibly work?!</h3>
<p>Yes, this is just as crazy as it sounds, and yet, it works (for certain problems, anyway).</p>
<p>The intuition is something like this: when <span class="math inline">\(n\)</span> is suitably large, the “point cloud” formed by <span class="math inline">\(X_1,X_2,\dots,X_n\)</span> looks a lot like the true population distribution.</p>
<p>As a result, resampling from the observed sample <span class="math inline">\(X_1,X_2,\dots,X_n\)</span> and resampling from the true population distribution are not actually so different!</p>
<p>The careful mathematical proof of this intuition is beyond the scope of this course. But I agree that on a first glance this should not work at all. And yet it does!</p>
<p>I have been studying statistics for more than 15 years, and I am still pretty sure the bootstrap is magic…</p>
</section>
<section id="example-estimating-the-poisson-rate-parameter" class="level3" data-number="34.5.2">
<h3 data-number="34.5.2" class="anchored" data-anchor-id="example-estimating-the-poisson-rate-parameter"><span class="header-section-number">34.5.2</span> Example: estimating the Poisson rate parameter</h3>
<p>Let’s start by illustrating on a simple data example that we have seen multiple times before. Let’s suppose that <span class="math inline">\(X_1,X_2,\dots,X_n\)</span> are drawn iid from a Poisson distribution with rate parameter <span class="math inline">\(\lambda = 5\)</span>.</p>
<p>Our goal is to construct a confidence interval for the rate parameter <span class="math inline">\(\lambda\)</span>.</p>
<p>Now, we’ve already seen ways to do this– we could construct a CLT-based confidence interval or use a simulation-based approach. The point here is just to illustrate how the bootstrap applies in a setting that we are already familiar with. The claim is <em>not</em> that this the bootstrap is the best solution to this particular problem.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">=</span> <span class="dv">25</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>lambdatrue <span class="ot">=</span> <span class="dv">5</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> <span class="fu">rpois</span>(<span class="at">n=</span>n, <span class="at">lambda=</span><span class="dv">5</span>); <span class="co"># Generate a sample of 25 iid RVs</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>lambdahat <span class="ot">=</span> <span class="fu">mean</span>(data); <span class="co"># Estimate lambda.</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, let's do the bootstrap.</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># We'll repeatedly (B times)  resample n=25 observations from the data.</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># On each resample, compute lambdahat (i.e., take the mean).</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>B <span class="ot">=</span> <span class="dv">200</span>; <span class="co"># Number of bootstrap replicates.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>replicates <span class="ot">=</span> <span class="fu">rep</span>(<span class="cn">NA</span>,B); <span class="co"># We'll store</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>( i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>B ) {</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sample WITH REPLACEMENT from the data sample itself.</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  resample <span class="ot">=</span> <span class="fu">sample</span>(data, n, <span class="at">replace=</span><span class="cn">TRUE</span>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Compute our statistic on the resample data.</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This is a *bootstrap replicate* of our statistic.</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  replicates[i] <span class="ot">=</span> <span class="fu">mean</span>(resample)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, <code>replicates</code> is a vector of (approximate) replicates of our estimate for <span class="math inline">\(\lambda\)</span>. Let’s visualize the replicates– we’ll indicate the true <span class="math inline">\(\lambda\)</span> in blue and our estimate (<code>lambdahat</code>) in red.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(replicates)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span>lambdahat, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">'red'</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span>lambdatrue, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">'blue'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="bootstrap_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Now, we’re going to use those bootstrap replicates to estimate the standard deviation of <span class="math inline">\(\hat{\lambda} = n^{-1} \sum_i X_i\)</span>, and then we’ll use that to get a 95% CI for <span class="math inline">\(\lambda\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>sd_lambda <span class="ot">=</span> <span class="fu">sd</span>( replicates )</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>CI <span class="ot">=</span> <span class="fu">c</span>( lambdahat<span class="fl">-1.96</span><span class="sc">*</span>sd_lambda, lambdahat<span class="fl">+1.96</span><span class="sc">*</span>sd_lambda)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># And check if our CI contains lambda = 5.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>(CI[<span class="dv">1</span>] <span class="sc">&lt;</span> lambdatrue) <span class="sc">&amp;</span> (lambdatrue <span class="sc">&lt;</span> CI[<span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>Well, about 95% of the time, we should catch <span class="math inline">\(\lambda=5\)</span>. Let’s run that same experiment a bunch of times, just to verify. That is, we are going to:</p>
<ol type="1">
<li>Generate data <span class="math inline">\(X_1,X_2,\dots,X_n\)</span> iid from Poisson with <span class="math inline">\(\lambda=5\)</span>.</li>
<li>Compute <span class="math inline">\(\hat{\lambda} = \bar{X}\)</span></li>
<li>Repeatedly resample from <span class="math inline">\(X_1,X_2,\dots,X_n\)</span> <em>with replacement</em>, compute the mean of each resample (i.e., compute our estimator on each resample)</li>
<li>Compute the standard deviation of these resampled copies of <span class="math inline">\(\hat{\lambda}\)</span>.</li>
<li>Use that SD to compute a 95% CI, under the assumption that <span class="math inline">\(\hat{\lambda}\)</span> is approximately normal about its expectation <span class="math inline">\(\lambda\)</span>.</li>
</ol>
<p>Okay, let’s do that in code. It will be useful to have a command that runs all of the bootstrap machinery for us.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>run_pois_bootstrap_expt <span class="ot">=</span> <span class="cf">function</span>( lambdatrue, n, B ) {</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># lambdatrue is the true value of lambda to use in generating our data.</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># n is the sample size.</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># B is the number of bootstrap replicates to use.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># First things first, generate data.</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">=</span> <span class="fu">rpois</span>( <span class="at">n=</span>n, <span class="at">lambda=</span>lambdatrue )</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  lambdahat <span class="ot">=</span> <span class="fu">mean</span>( data ); <span class="co"># Our point estimate for lambda.</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Generate B bootstrap replicates.</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  replicates <span class="ot">=</span> <span class="fu">rep</span>(<span class="cn">NA</span>,B)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Each replicate draws n data points, with replacement, from data</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># and computes its mean (i.e., estimates lambda from the resampled data)</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>( i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>B ) {</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># resample n elements of the data, with replacement.</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    resampled_data <span class="ot">=</span> <span class="fu">sample</span>( data, n, <span class="at">replace=</span><span class="cn">TRUE</span> )</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    replicates[i] <span class="ot">=</span> <span class="fu">mean</span>( resampled_data )</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Now use those replicates to estimate SD of and construct a 95% CI.</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>  sd_boot <span class="ot">=</span> <span class="fu">sd</span>( replicates ); <span class="co"># estimate of the std dev of alphahat</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>  CI <span class="ot">=</span> <span class="fu">c</span>(lambdahat<span class="fl">-1.96</span><span class="sc">*</span>sd_boot, lambdahat<span class="fl">+1.96</span><span class="sc">*</span>sd_boot)</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Finally, check if this CI caught lambda successfully.</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return TRUE/FALSE accordingly.</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>( (CI[<span class="dv">1</span>] <span class="sc">&lt;</span> lambdatrue) <span class="sc">&amp;</span> (lambdatrue <span class="sc">&lt;</span> CI[<span class="dv">2</span>]) )</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, let’s repeat this experiment a few hundred times, and see how often our CI contains the true <span class="math inline">\(\lambda\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>N_expt <span class="ot">=</span> <span class="dv">500</span>; <span class="co"># number of CIs to construct.</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>successes <span class="ot">=</span> <span class="fu">rep</span>(<span class="cn">NA</span>, N_expt); <span class="co"># Keep track of whether or not each CI caught alpha.</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>( i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N_expt ) {</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Repeat the experiment N_expt times.</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># lambdatrue=5, B=200 bootstrap replicates, n=25 observations in the data sample.</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  successes[i] <span class="ot">=</span> <span class="fu">run_pois_bootstrap_expt</span>( <span class="dv">5</span>, <span class="dv">200</span>, <span class="dv">25</span> )</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(successes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.932</code></pre>
</div>
</div>
<p>That number should be between 0.93 and 0.97 (of course, we are always subject to randomness in our experiments…).</p>
</section>
<section id="recap-general-recipe-for-the-bootstrap" class="level3" data-number="34.5.3">
<h3 data-number="34.5.3" class="anchored" data-anchor-id="recap-general-recipe-for-the-bootstrap"><span class="header-section-number">34.5.3</span> Recap: general recipe for the bootstrap</h3>
<p>Just to drive things home, let’s walk through the “recipe” for the bootstrap again, this time at a slightly more abstract level. Then we’ll come back and do a more complicated example.</p>
<p>Suppose that we have data <span class="math inline">\(X_1,X_2,\dots,X_n\)</span> drawn iid from some unknown distribution. We wish to estimate a parameter <span class="math inline">\(\theta\)</span>, and we have an estimator <span class="math inline">\(\hat{\theta} = \hat{\theta}(X_1,X_2,\dots,X_n)\)</span> for <span class="math inline">\(\theta\)</span>.</p>
<p>The basic idea behind the bootstrap is to resample from the data <span class="math inline">\(X_1,X_2,\dots,X_n\)</span> with replacement, evaluate <span class="math inline">\(\hat{\theta}\)</span> on each resample, and use those <em>replicates</em> of <span class="math inline">\(\hat{\theta}(X_1,X_2,\dots,X_n)\)</span> to approximate its true distribution (usually we are specifically interested in variance, but we’ll come back to this point).</p>
<p>So, given data <span class="math inline">\(X_1,X_2,\dots,X_n\)</span>, we:</p>
<ol type="1">
<li><p>Repeatedly (<span class="math inline">\(B\)</span> times) sample <span class="math inline">\(n\)</span> observations <em>with replacement</em> from <span class="math inline">\(X_1,X_2,\dots,X_n\)</span>, to obtain samples <span class="math inline">\(X_{b,1}^*,X_{b,2}^*,\dots,X_{b,n}^*\)</span>, for <span class="math inline">\(b=1,2,\dots,B\)</span>. Note that putting the asterisk (*) on the resampled data points is a common notation in statistics to indicate bootstrap samples.</p></li>
<li><p>For each of these <span class="math inline">\(B\)</span> resamples, compute the estimator on that sample, to obtain <span class="math display">\[
\hat{\theta}_b = \hat{\theta}(X_{b,1}^*,X_{b,2}^*,\dots,X_{b,n}^*) ~~~ \text{ for } b=1,2,\dots,B.
\]</span></p></li>
<li><p>Compute the standard deviation of our bootstrap replicates, <span class="math display">\[
\operatorname{SE}_{\text{boot}}
= \sqrt{ \frac{1}{B-1} \sum_{b=1}^B \left( \hat{\theta}_b - \frac{1}{B}\sum_{r=1}^B \hat{\theta}_r \right)^2 }.
\]</span></p></li>
<li><p>Use this standard deviation estimate to construct an (approximate) confidence interval, under the assumption that <span class="math inline">\(\hat{\theta}\)</span> is normally distributed about its mean <span class="math inline">\(\theta\)</span>. <span class="math display">\[
(\hat{\theta} - 1.96\operatorname{SE}_{\text{boot}},
\hat{\theta} + 1.96\operatorname{SE}_{\text{boot}} )
\]</span></p></li>
</ol>
</section>
</section>
<section id="bootstrapping-for-more-complicated-statistics" class="level2" data-number="34.6">
<h2 data-number="34.6" class="anchored" data-anchor-id="bootstrapping-for-more-complicated-statistics"><span class="header-section-number">34.6</span> Bootstrapping for more complicated statistics</h2>
<p>Now, our example above is kind of silly– we already know multiple different ways to construct confidence intervals for the Poisson parameter!</p>
<p>But what about more complicated functions of our data? That is often where the bootstrap really shines.</p>
<p>To see this, let’s return to our example of financial returns <span class="math inline">\((X_i,Y_i)\)</span></p>
<p>The bootstrap says that we should sample <em>with replacement</em> from the observed data <span class="math display">\[
(X_1,Y_1), (X_2,Y_2), \dots, (X_n, Y_n),
\]</span> obtaining the sample <span class="math display">\[
(X^*_1,Y^*_1), (X^*_2,Y^*_2), \dots, (X^*_n, Y^*_n).
\]</span> Again, the <span class="math inline">\(X^*_i\)</span> notation is the conventional way to show that the variable is resampled from the original data.</p>
<p>Having resampled from our data in this way, we could then compute <span class="math display">\[
\alpha^* = \hat{\alpha}\left( (X^*_1,Y^*_1), (X^*_2,Y^*_2), \dots, (X^*_n, Y^*_n)  \right).
\]</span> Repeating this, say, <span class="math inline">\(B\)</span> times, we would obtain <em>bootstrap replicates</em> <span class="math display">\[
\alpha^*_1, \alpha^*_2, \dots, \alpha^*_B,
\]</span> from which we can estimate the variance of <span class="math inline">\(\hat{\alpha}\)</span> as <span class="math display">\[
\hat{\sigma}^2_{\alpha}
=
\frac{1}{B-1}\sum_{r=1}^B \left( \alpha^*_r - \frac{1}{B} \sum_{b=1}^B \alpha^*_b \right)^2.
\]</span></p>
<p>Notice that this <em>looks</em> like a variance, except that we are using <span class="math inline">\(\hat{\alpha}\)</span>, the statistic computed on the original data sample, as our estimate of the mean.</p>
<section id="demo-applying-the-bootstrap-to-financial-data" class="level3" data-number="34.6.1">
<h3 data-number="34.6.1" class="anchored" data-anchor-id="demo-applying-the-bootstrap-to-financial-data"><span class="header-section-number">34.6.1</span> Demo: applying the bootstrap to financial data</h3>
<p>The following chunk contains code for generating <span class="math inline">\((X_i,Y_i)\)</span> pairs like those discussed in our financial example above.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(MASS)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: MASS</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'MASS' was built under R version 4.2.3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>generate_pairs <span class="ot">=</span> <span class="cf">function</span>( n ) {</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Generate n pairs of financial returns.</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  muX <span class="ot">=</span> <span class="dv">2</span>; muY <span class="ot">=</span> <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  CovMx <span class="ot">=</span> <span class="fu">matrix</span>( <span class="fu">c</span>(<span class="dv">1</span>,<span class="sc">-</span>.<span class="dv">25</span>,<span class="sc">-</span>.<span class="dv">25</span>,<span class="dv">2</span>), <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">=</span> <span class="fu">mvrnorm</span>(<span class="at">n=</span><span class="dv">100</span>, <span class="at">mu=</span><span class="fu">c</span>(muX,muY), <span class="at">Sigma=</span>CovMx)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>( <span class="fu">data.frame</span>( <span class="st">'X'</span><span class="ot">=</span>data[,<span class="dv">1</span>], <span class="st">'Y'</span><span class="ot">=</span>data[,<span class="dv">2</span>]) )</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>fin_pairs <span class="ot">=</span> <span class="fu">generate_pairs</span>( <span class="dv">100</span> ); <span class="co"># Generate 100 (X,Y) pairs.</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(fin_pairs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          X           Y
1 -1.149327 -0.66960862
2  1.151513 -0.17073492
3 -0.717036 -1.30541169
4  1.850979 -2.16893482
5  2.029031 -2.32692980
6  1.848073  0.07619855</code></pre>
</div>
</div>
<p>Always look at your data first. Here is a scatter plot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>pp <span class="ot">=</span> <span class="fu">ggplot</span>(<span class="at">data=</span>fin_pairs, <span class="fu">aes</span>(<span class="at">x=</span>X, <span class="at">y=</span>Y)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>pp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="bootstrap_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Now, let’s compute <span class="math inline">\(\hat{\alpha}\)</span> on this data. Remember, <span class="math inline">\(\hat{\alpha}\)</span> is just a function of the (estimated) variances of <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>, along with their covariance: <span class="math display">\[
\hat{\alpha}
= \frac{ \hat{\sigma}_Y^2 - \hat{\sigma}_{XY} }
        { \hat{\sigma}_X^2 + \hat{\sigma}_Y^2 -2\hat{\sigma}_{XY} }.
\]</span> So, let’s just compute those three quantities and plug them in. The <code>cov</code> function gets us the whole sample covariance matrix of our data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>Sigmahat <span class="ot">=</span> <span class="fu">cov</span>( fin_pairs ); <span class="co">#Sigma is the common symbol for a covariance matrix.</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>Sigmahat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          X         Y
X  1.436377 -0.481378
Y -0.481378  1.711926</code></pre>
</div>
</div>
<p>Now we can just pluck our three estimates out of there</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>sigma2hatXX <span class="ot">=</span> Sigmahat[<span class="dv">1</span>,<span class="dv">1</span>]</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>sigma2hatYY <span class="ot">=</span> Sigmahat[<span class="dv">2</span>,<span class="dv">2</span>]</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>sigmahatXY <span class="ot">=</span> Sigmahat[<span class="dv">1</span>,<span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>and we can plug these into our formula for <span class="math inline">\(\hat{\alpha}\)</span> above.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>alphahat <span class="ot">=</span> (sigma2hatYY <span class="sc">-</span> sigmahatXY)<span class="sc">/</span>(sigma2hatXX <span class="sc">+</span> sigma2hatYY <span class="sc">-</span><span class="dv">2</span><span class="sc">*</span>sigmahatXY)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>alphahat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.5335132</code></pre>
</div>
</div>
<p>Now, in truth, the covariances that generated our data are: <span class="math display">\[
\sigma^2_X = 1,~~~\sigma^2_Y = 2, ~~~\sigma_{XY} = -0.25,
\]</span> so the true optimal choice of <span class="math inline">\(\alpha\)</span> is <span class="math display">\[
\alpha = \frac{ \sigma_Y^2 - \sigma_{XY} }
        { \sigma_X^2 + \sigma_Y^2 -2\sigma_{XY} }
        = \frac{2 - (-0.25) }{ 1 + 2 + 2*0.25  }
        = \frac{ 2.25 }{3.5 } \approx 0.64
\]</span> Let’s store the true value of alpha while we’re thinking of it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>sigma2XX <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>sigma2YY <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>sigmaXY <span class="ot">=</span> <span class="sc">-</span><span class="fl">0.25</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>alpha_true <span class="ot">=</span>(sigma2YY <span class="sc">-</span> sigmaXY)<span class="sc">/</span>(sigma2XX <span class="sc">+</span> sigma2YY <span class="sc">-</span><span class="dv">2</span><span class="sc">*</span>sigmaXY)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>alpha_true</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6428571</code></pre>
</div>
</div>
<p>Now, again, we’re going to resample <em>with replacement</em> from our data, and compute our statistic <span class="math inline">\(\hat{\alpha}\)</span> on each resample. The hope is that these resampled versions of the statistic will resemble the distribution of the statistic evaluated on the original data.</p>
<p>It will be convenient to just have a function to compute alphahat from a given data set.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>compute_alphahat <span class="ot">=</span> <span class="cf">function</span>( data ) {</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># We're assuming that data is a data frame with two columns.</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  Sigmahat <span class="ot">=</span> <span class="fu">cov</span>( data )</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract the variance and covariance estimates from the sample covariance</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  sigma2hatXX <span class="ot">=</span> Sigmahat[<span class="dv">1</span>,<span class="dv">1</span>]</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  sigma2hatYY <span class="ot">=</span> Sigmahat[<span class="dv">2</span>,<span class="dv">2</span>]</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  sigmahatXY <span class="ot">=</span> Sigmahat[<span class="dv">1</span>,<span class="dv">2</span>]</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plug these into the definition of alpha.</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  alphahat <span class="ot">=</span> (sigma2hatYY <span class="sc">-</span> sigmahatXY)<span class="sc">/</span>(sigma2hatXX <span class="sc">+</span> sigma2hatYY <span class="sc">-</span><span class="dv">2</span><span class="sc">*</span>sigmahatXY)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(alphahat)</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>alphahat <span class="ot">=</span> <span class="fu">compute_alphahat</span>( fin_pairs )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Okay, we’re ready to go. Let’s resample the data <span class="math inline">\(B=200\)</span> times, evaluating <span class="math inline">\(\hat{\alpha}\)</span> on each resample. Then, we’ll use those resampled values to estimate the variance.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>B <span class="ot">=</span> <span class="dv">200</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>replicates <span class="ot">=</span> <span class="fu">rep</span>(<span class="cn">NA</span>,B)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">=</span> <span class="fu">nrow</span>( fin_pairs ); <span class="co"># number of observations in our data set.</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>( i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>B ) {</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># To resample the data, we will sample indices, and then grab those rows.</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  resample_indices <span class="ot">=</span> <span class="fu">sample</span>( <span class="dv">1</span><span class="sc">:</span>n, n, <span class="at">replace=</span><span class="cn">TRUE</span> )</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  resampled_data <span class="ot">=</span> fin_pairs[resample_indices,]</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  replicates[i] <span class="ot">=</span> <span class="fu">compute_alphahat</span>( resampled_data )</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>( replicates )</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>( <span class="at">v=</span>alphahat, <span class="at">col=</span><span class="st">'red'</span>, <span class="at">lwd=</span><span class="dv">2</span>); <span class="co"># alpha of true data.</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>( <span class="at">v=</span><span class="fl">0.64</span>, <span class="at">col=</span><span class="st">'blue'</span>, <span class="at">lwd=</span><span class="dv">2</span>); <span class="co"># True alpha</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="bootstrap_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>So the red line indicates the value of <span class="math inline">\(\alpha\)</span> estimated from the original data in the data frame <code>fin_pairs</code>, while the blue line indicates the true value of <span class="math inline">\(\alpha\)</span> computed from the true covariance structure of <span class="math inline">\((X,Y)\)</span>.</p>
<p>Clearly, our resampled data is centering about our estimate of <span class="math inline">\(\alpha\)</span>, not its true value.</p>
<p>But that is okay! We just want to use our bootstrap replicates to estimate the variance, so that we can center a confidence interval at our estimate…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate the variance of alphahat from our bootstrap replicates.</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>sd_alphahat <span class="ot">=</span> <span class="fu">sd</span>( replicates ); <span class="co"># estimate of the std dev of alphahat</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>CI <span class="ot">=</span> <span class="fu">c</span>(alphahat<span class="fl">-1.96</span><span class="sc">*</span>sd_alphahat, alphahat<span class="fl">+1.96</span><span class="sc">*</span>sd_alphahat)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>CI</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.4609714 0.6060550</code></pre>
</div>
</div>
<p>…and we can verify that the CI contains the true value of <span class="math inline">\(\alpha\)</span> (about 95% of the time you run this code, anyway):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>(CI[<span class="dv">1</span>] <span class="sc">&lt;</span> alpha_true) <span class="sc">&amp;</span> (alpha_true <span class="sc">&lt;</span> CI[<span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
</div>
<p>Just to verify, let’s rerun this whole machinery a few times, and check that our bootstrap-based CI catches <span class="math inline">\(\alpha\)</span> about 95% of the time.</p>
<p>Importantly, that “95% of the time” means “if we generate new data, then 95% of the time, our bootstrap-based CI will catch the true value of <span class="math inline">\(\alpha\)</span>.”</p>
<p>To do this experiment, we want a function to run the above procedure once for us on a given data frame and a given number of bootstrap replicates.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>run_bootstrap_expt <span class="ot">=</span> <span class="cf">function</span>( B ) {</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># B is the number of bootstrap replicates to use.</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Generate new data: 1-- X-Y pairs.</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">=</span> <span class="fu">generate_pairs</span>( <span class="dv">100</span> )</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Generate B bootstrap replicates.</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  replicates <span class="ot">=</span> <span class="fu">rep</span>(<span class="cn">NA</span>,B)</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Each replicate draws n data points, with replacement, from fin_pairs.</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">=</span> <span class="fu">nrow</span>( data ); <span class="co"># number of observations in our data set.</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>( i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>B ) {</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># To resample the data, we will sample indices, and then grab those rows.</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>    resample_indices <span class="ot">=</span> <span class="fu">sample</span>( <span class="dv">1</span><span class="sc">:</span>n, n, <span class="at">replace=</span><span class="cn">TRUE</span> )</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>    resampled_data <span class="ot">=</span> data[resample_indices,]</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>    replicates[i] <span class="ot">=</span> <span class="fu">compute_alphahat</span>( resampled_data )</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Now use those replicates to estimate SD of alphahat and construct a 95% CI.</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>  alphahat <span class="ot">=</span> <span class="fu">compute_alphahat</span>( data )</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>  sd_alphahat <span class="ot">=</span> <span class="fu">sd</span>( replicates ); <span class="co"># estimate of the std dev of alphahat</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>  CI <span class="ot">=</span> <span class="fu">c</span>(alphahat<span class="fl">-1.96</span><span class="sc">*</span>sd_alphahat, alphahat<span class="fl">+1.96</span><span class="sc">*</span>sd_alphahat)</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Finally, check if this CI caught alpha successfully.</span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return TRUE/FALSE accordingly.</span></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>( (CI[<span class="dv">1</span>] <span class="sc">&lt;</span> alpha_true) <span class="sc">&amp;</span> (alpha_true <span class="sc">&lt;</span> CI[<span class="dv">2</span>]) )</span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>N_expt <span class="ot">=</span> <span class="dv">200</span>; <span class="co"># number of CIs to construct.</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>successes <span class="ot">=</span> <span class="fu">rep</span>(<span class="cn">NA</span>,N_expt); <span class="co"># Keep track of whether or not each CI caught alpha.</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>( i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N_expt ) {</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  successes[i] <span class="ot">=</span> <span class="fu">run_bootstrap_expt</span>( <span class="dv">200</span> ); <span class="co"># Using B=200 replicates.</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(successes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.925</code></pre>
</div>
</div>
<p>Once again, this should be approximately 0.95, up to the randomness in our experiment.</p>
</section>
</section>
<section id="limitations-and-extensions-of-the-bootstrap" class="level2" data-number="34.7">
<h2 data-number="34.7" class="anchored" data-anchor-id="limitations-and-extensions-of-the-bootstrap"><span class="header-section-number">34.7</span> Limitations and extensions of the bootstrap</h2>
<p>Now, the bootstrap is magic, at least when it works.</p>
<p>But the set of problems for which the “classical” bootstrap (i.e., the version of the bootstrap outlined above) works, is pretty limited.</p>
<p>Here’s a simple example of where the bootstrap can fail.</p>
<section id="example-estimating-the-distribution-of-the-maximum" class="level3" data-number="34.7.1">
<h3 data-number="34.7.1" class="anchored" data-anchor-id="example-estimating-the-distribution-of-the-maximum"><span class="header-section-number">34.7.1</span> Example: estimating the distribution of the maximum</h3>
<p>Suppose that we see data <span class="math inline">\(X_1,X_2,\dots,X_n\)</span> drawn iid from some distribution, and we are interested in the distribution of <span class="math display">\[
M = \max\{ X_1, X_2, \dots, X_n \}.
\]</span> In particular, suppose we want to estimate <span class="math inline">\(\mathbb{E} M\)</span>.</p>
<p>The bootstrap would suggest that we sample <span class="math inline">\(X_1^*,X_2,^*,\dots,X_n^*\)</span> with replacement from <span class="math inline">\(X_1,X_2,\dots,X_n\)</span> and compute <span class="math display">\[
M^* = \max\{ X_1^*, X_2^*, \dots, X_n^* \}.
\]</span> Repeating this <span class="math inline">\(B\)</span> times, we get replicates <span class="math inline">\(M_1^*,M_2^*,\dots,M_B^*\)</span>, and we can compute their standard deviation to estimate the standard deviation of our variable of interest <span class="math inline">\(M\)</span>.</p>
<p>Now let’s implement that and see how well it works.</p>
<p>We’ll draw our data from a standard normal. First, let’s generate a bunch of copies of <span class="math inline">\(M\)</span>, so we can see its distribution (and its variance, in particular).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>n_samp <span class="ot">=</span> <span class="dv">25</span>; <span class="co"># Number of data samples to take</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>n_rep <span class="ot">=</span> <span class="dv">2000</span>; <span class="co"># Number of replicates of M to create.</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>M_reps <span class="ot">=</span> <span class="fu">rep</span>( <span class="cn">NA</span>, n_rep )</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>( i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_rep ) {</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="at">n=</span>n_samp)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  M_reps[i] <span class="ot">=</span> <span class="fu">max</span>(data)</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>( M_reps )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="bootstrap_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The true value of <span class="math inline">\(\mathbb{E} M\)</span> is actually very hard to compute, but we can use Monte Carlo estimation to approximate it:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>ExpecM <span class="ot">=</span> <span class="fu">mean</span>(M_reps)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>ExpecM</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.953449</code></pre>
</div>
</div>
<p>In particular, the (sample) standard deviation is</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(M_reps)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.5014746</code></pre>
</div>
</div>
<p>Now, let’s generate a new sample and run the bootstrap on it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="at">n=</span>n_samp)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>B <span class="ot">=</span> <span class="dv">200</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>Mboot_reps <span class="ot">=</span> <span class="fu">rep</span>( <span class="cn">NA</span>, B )</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>( b <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>B ){</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  resamp <span class="ot">=</span> <span class="fu">sample</span>( data, n_samp, <span class="at">replace=</span><span class="cn">TRUE</span>)</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  Mboot_reps[b] <span class="ot">=</span> <span class="fu">max</span>(resamp)</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(Mboot_reps)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="bootstrap_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Yikes! That looks <em>very</em> different from the true distribution of <span class="math inline">\(M\)</span> we saw above…</p>
<p>Let’s just check the variance? Maybe it’s close to the observed <span class="math inline">\(\sigma_M \approx 0.483\)</span>?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(Mboot_reps)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.4090479</code></pre>
</div>
</div>
<p>Compare with</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(M_reps)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.5014746</code></pre>
</div>
</div>
<p>And if we try to construct a confidence interval, we get a CI</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>M <span class="ot">=</span> <span class="fu">max</span>(data)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>seMboot <span class="ot">=</span> <span class="fu">sd</span>(Mboot_reps)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>CI <span class="ot">=</span> <span class="fu">c</span>( M<span class="fl">-1.96</span><span class="sc">*</span>seMboot, M<span class="fl">+1.96</span><span class="sc">*</span>seMboot )</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>CI</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.219668 2.823136</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>(CI[<span class="dv">1</span>] <span class="sc">&lt;</span> ExpecM) <span class="sc">&amp;</span> (ExpecM <span class="sc">&lt;</span> CI[<span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>Okay, but we really have to run the experiment multiple times, so let’s package it up in a function…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A function to repeat the same experiment easily without having to repeat ourselves.</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>run_max_boot_expt <span class="ot">=</span> <span class="cf">function</span>( n, B ) {</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">=</span> <span class="fu">rnorm</span>(n)</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  M <span class="ot">=</span> <span class="fu">max</span>(data)</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  Mboot_reps <span class="ot">=</span> <span class="fu">rep</span>(<span class="cn">NA</span>,B)</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(b <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>B) {</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>    resamp <span class="ot">=</span> <span class="fu">sample</span>( data, n, <span class="at">replace=</span><span class="cn">TRUE</span>)</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>    Mboot_reps[b] <span class="ot">=</span> <span class="fu">max</span>(resamp)</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>  seMboot <span class="ot">=</span> <span class="fu">sd</span>(Mboot_reps)</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>  CI <span class="ot">=</span> <span class="fu">c</span>( M<span class="fl">-1.96</span><span class="sc">*</span>seMboot, M<span class="fl">+1.96</span><span class="sc">*</span>seMboot )</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>( CI[<span class="dv">1</span>] <span class="sc">&lt;</span> ExpecM <span class="sc">&amp;</span> ExpecM <span class="sc">&lt;</span> CI[<span class="dv">2</span>] )</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>…and, just like we’ve done above, we’ll generate data samples a bunch of times and see how often our bootstrap CI catches the (estimated!) true value of <span class="math inline">\(\mathbb{E}M\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>Nexpt <span class="ot">=</span> <span class="dv">500</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>successes <span class="ot">=</span> <span class="fu">rep</span>(<span class="cn">NA</span>,Nexpt)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>Nexpt) {</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  successes[i] <span class="ot">=</span> <span class="fu">run_max_boot_expt</span>( n_samp, <span class="dv">200</span> )</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(successes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.73</code></pre>
</div>
</div>
<p>Hmm… Not ideal.</p>
<p>The problem is that the bootstrap tends (usually! it’s possible that we got lucky when knitting, but unlikely) to vastly underestimate the variance of “challenging” functions like the maximum.</p>
<p>Generally speaking, the bootstrap only works well when the statistic we are trying to work with is approximately normal about its expectation. The maximum of a collection of variables does obey a central limit theorem, but its limiting distribution is <em>not</em> a normal!</p>
<p>See <a href="https://en.wikipedia.org/wiki/Extreme_value_theory">here</a> if you’re curious to learn more.</p>
</section>
<section id="a-cautionary-tale" class="level3" data-number="34.7.2">
<h3 data-number="34.7.2" class="anchored" data-anchor-id="a-cautionary-tale"><span class="header-section-number">34.7.2</span> A cautionary tale</h3>
<p>There are, in fact, ways to modify the bootstrap to handle issues like resampling “challenging” functions like the maximum, but those are going to have to wait for your more advanced courses.</p>
<p>The above example is just a cautionary tale of how important it is to know the limitations of the methods that you are using. The bootstrap works amazingly for the problems that it is “right” for, but it is also demonstrably bad for certain other problems.</p>
<p>Generally speaking, it’s important to know what tool is right for what job!</p>
</section>
</section>
<section id="review" class="level2" data-number="34.8">
<h2 data-number="34.8" class="anchored" data-anchor-id="review"><span class="header-section-number">34.8</span> Review</h2>
<p>In these notes we covered</p>
<ul>
<li>Situations where Parametric Estimation is inadequate</li>
<li>A General method for bootstrap estimation</li>
<li>Bootstrap estimation for univariate data</li>
<li>Bootstrap estimation for bivariate data</li>
<li>Limitations of bootstrapping</li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
  </div>
  <div class="nav-page nav-page-next">
      <a href="./bootstrap_practice.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">35</span>&nbsp; <span class="chapter-title">Bootstrap Practice</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>