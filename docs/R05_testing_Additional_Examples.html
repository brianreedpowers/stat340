<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>STAT 340: Data Science II - 16&nbsp; Monte Carlo Testing: Additional Examples</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./testing2_practice.html" rel="next">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./testing1.html">Testing</a></li><li class="breadcrumb-item"><a href="./R05_testing_Additional_Examples.html"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Monte Carlo Testing: Additional Examples</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">STAT 340: Data Science II</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">STAT 340 Index</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false">
 <span class="menu-text">Sampling</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rv.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Random Variables</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./R01_RandomVariables.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Random Variables R Examples</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rv_practice.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Probability and Random Variables Practice</span></span></a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./cov.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Independence, Conditional Probability and Bayes’ Rule</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./R02_IndepCondBayes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Independence, Conditional Probability and Bayes Theorem R Examples</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./cov_practice.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Independence and Conditional Probability Practice</span></span></a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Monte Carlo</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./R03_MonteCarloExamples.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Monte Carlo Examples</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mc_practice.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Monte Carlo Practice</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./R_MonteCarlo_Battleship.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Monte Carlo Battleship</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Testing</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./testing1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Introduction to Statistical Testing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./R04_Monte_Carlo_Testing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Monte Carlo Testing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./testing1_practice.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Monte Carlo Testing Practice</span></span></a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./R05_testing_Additional_Examples.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Monte Carlo Testing: Additional Examples</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./testing2_practice.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Testing and Power Practice</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">
 <span class="menu-text">Estimation</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./estimation1_practice.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Point Estimation Practice</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./R06_More_Estimation_Examples.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Estimation Examples</span></span></a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./estimation2_practice.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Interval Estimation Practice</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./R07_More_Estimation_and_CI_Examples.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Interval Estimation Examples</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false">
 <span class="menu-text">Prediction</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./slr_practice.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Simple Linear Regression Practice</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./R08_prediction_examples.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Simple Linear Regression - Examples</span></span></a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mlr_practice.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Multiple Linear Regression Practice</span></span></a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./logistic_practice.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Logistic Regression Practice</span></span></a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./cv_practice.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Cross Validation Practice</span></span></a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bootstrap_practice.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Bootstrap Practice</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./RV_summary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Random Variable Summary</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#type-1-errors-and-the-p-value-distribution" id="toc-type-1-errors-and-the-p-value-distribution" class="nav-link active" data-scroll-target="#type-1-errors-and-the-p-value-distribution"><span class="header-section-number">16.1</span> Type 1 Errors and the P-Value Distribution</a></li>
  <li><a href="#achieving-exact-alpha-with-a-discrete-test-statistic-distribution" id="toc-achieving-exact-alpha-with-a-discrete-test-statistic-distribution" class="nav-link" data-scroll-target="#achieving-exact-alpha-with-a-discrete-test-statistic-distribution"><span class="header-section-number">16.2</span> Achieving exact alpha with a discrete test statistic distribution</a></li>
  <li><a href="#example-comparing-consistency" id="toc-example-comparing-consistency" class="nav-link" data-scroll-target="#example-comparing-consistency"><span class="header-section-number">16.3</span> Example: Comparing Consistency</a></li>
  <li><a href="#coin-flips" id="toc-coin-flips" class="nav-link" data-scroll-target="#coin-flips"><span class="header-section-number">16.4</span> Coin Flips</a></li>
  <li><a href="#example-hot-hands" id="toc-example-hot-hands" class="nav-link" data-scroll-target="#example-hot-hands"><span class="header-section-number">16.5</span> Example: hot hands</a>
  <ul class="collapse">
  <li><a href="#attempt-1-run-length" id="toc-attempt-1-run-length" class="nav-link" data-scroll-target="#attempt-1-run-length"><span class="header-section-number">16.5.1</span> Attempt 1: run length</a></li>
  <li><a href="#attempt-2-running-odds-ratio" id="toc-attempt-2-running-odds-ratio" class="nav-link" data-scroll-target="#attempt-2-running-odds-ratio"><span class="header-section-number">16.5.2</span> Attempt 2: running odds ratio</a></li>
  </ul></li>
  <li><a href="#permutation-test-drug-trials-extended" id="toc-permutation-test-drug-trials-extended" class="nav-link" data-scroll-target="#permutation-test-drug-trials-extended"><span class="header-section-number">16.6</span> Permutation test: Drug Trials (Extended)</a></li>
  <li><a href="#random-number-string" id="toc-random-number-string" class="nav-link" data-scroll-target="#random-number-string"><span class="header-section-number">16.7</span> Random number string</a>
  <ul class="collapse">
  <li><a href="#mean-absolute-deviation" id="toc-mean-absolute-deviation" class="nav-link" data-scroll-target="#mean-absolute-deviation"><span class="header-section-number">16.7.1</span> Mean Absolute deviation</a></li>
  <li><a href="#number-of-positive-differences" id="toc-number-of-positive-differences" class="nav-link" data-scroll-target="#number-of-positive-differences"><span class="header-section-number">16.7.2</span> Number of positive differences</a></li>
  <li><a href="#standard-deviation-of-differences" id="toc-standard-deviation-of-differences" class="nav-link" data-scroll-target="#standard-deviation-of-differences"><span class="header-section-number">16.7.3</span> Standard Deviation of Differences</a></li>
  <li><a href="#mean-absolute-difference" id="toc-mean-absolute-difference" class="nav-link" data-scroll-target="#mean-absolute-difference"><span class="header-section-number">16.7.4</span> Mean absolute difference</a></li>
  <li><a href="#comparing-the-test-statistics" id="toc-comparing-the-test-statistics" class="nav-link" data-scroll-target="#comparing-the-test-statistics"><span class="header-section-number">16.7.5</span> Comparing The Test Statistics</a></li>
  </ul></li>
  <li><a href="#random-visual-noise-detection" id="toc-random-visual-noise-detection" class="nav-link" data-scroll-target="#random-visual-noise-detection"><span class="header-section-number">16.8</span> Random Visual Noise detection</a>
  <ul class="collapse">
  <li><a href="#test-stat-1-variability-in-number-of-1s-per-region" id="toc-test-stat-1-variability-in-number-of-1s-per-region" class="nav-link" data-scroll-target="#test-stat-1-variability-in-number-of-1s-per-region"><span class="header-section-number">16.8.1</span> Test Stat 1: variability in number of 1s per region</a></li>
  <li><a href="#test-stat-2-horizontal-symmetry" id="toc-test-stat-2-horizontal-symmetry" class="nav-link" data-scroll-target="#test-stat-2-horizontal-symmetry"><span class="header-section-number">16.8.2</span> Test Stat 2: Horizontal Symmetry</a></li>
  <li><a href="#test-stat-3-neighbor-edges" id="toc-test-stat-3-neighbor-edges" class="nav-link" data-scroll-target="#test-stat-3-neighbor-edges"><span class="header-section-number">16.8.3</span> Test stat 3: Neighbor edges</a></li>
  <li><a href="#test-stat-4-morans-i" id="toc-test-stat-4-morans-i" class="nav-link" data-scroll-target="#test-stat-4-morans-i"><span class="header-section-number">16.8.4</span> Test Stat 4: Moran’s I</a></li>
  <li><a href="#test-statistic-5-number-of-clumps" id="toc-test-statistic-5-number-of-clumps" class="nav-link" data-scroll-target="#test-statistic-5-number-of-clumps"><span class="header-section-number">16.8.5</span> Test Statistic 5: Number of clumps</a></li>
  <li><a href="#test-statistic-6-variation-in-clump-sizes" id="toc-test-statistic-6-variation-in-clump-sizes" class="nav-link" data-scroll-target="#test-statistic-6-variation-in-clump-sizes"><span class="header-section-number">16.8.6</span> Test Statistic 6: Variation in clump sizes</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Monte Carlo Testing: Additional Examples</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="type-1-errors-and-the-p-value-distribution" class="level2" data-number="16.1">
<h2 data-number="16.1" class="anchored" data-anchor-id="type-1-errors-and-the-p-value-distribution"><span class="header-section-number">16.1</span> Type 1 Errors and the P-Value Distribution</h2>
<p>I want to sample from <span class="math inline">\(N(\mu, 5^2)\)</span></p>
<p>Say I want to test <span class="math inline">\(H_0: \mu = 10\)</span> vs <span class="math inline">\(H_A: \mu &gt; 10\)</span></p>
<p>I can use the test statistic simply being <span class="math inline">\(\bar{X}\)</span>. Naturally if <span class="math inline">\(\bar{X}\)</span> is high then I would consider that evidence against <span class="math inline">\(H_0\)</span>.</p>
<p>Here’s a function to generate sample data given <span class="math inline">\(\mu\)</span> and a test statistic function.</p>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-2_3d47fc8e0c95bbf146f2423c39560c84">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>generate_data <span class="ot">&lt;-</span> <span class="cf">function</span>(n, mu){</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">rnorm</span>(n, mu, <span class="dv">5</span>))</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>test_stat <span class="ot">&lt;-</span> <span class="cf">function</span>(someData){</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">mean</span>(someData))</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Suppose we want to use a significance level of 7%. Why 7%? Why not!?! Imagine here is some data - note that this data is being generated from an alternative model (<span class="math inline">\(\mu=11\)</span>).</p>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-3_ab20344cc038c0cb3529eff064a0cb30">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>myData <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">25</span>, <span class="dv">11</span>, <span class="dv">5</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>myData</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  7.86773095 11.91821662  6.82185694 18.97640401 12.64753886  6.89765808
 [7] 13.43714526 14.69162353 13.87890676  9.47305806 18.55890584 12.94921618
[13]  7.89379710 -0.07349944 16.62465459 10.77533195 10.91904868 15.71918105
[19] 15.10610598 13.96950661 15.59488686 14.91068150 11.37282492  1.05324152
[25] 14.09912874</code></pre>
</div>
</div>
<p>Let’s generate a test statistic distribution under the null hypothesis. What are typical values of <span class="math inline">\(\bar{X}\)</span> when the null hypothesis is true? If you remember the central limit theorem it will come as no surprise that this distribution is <span class="math inline">\(N(10, 5^2/25)\)</span></p>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-4_7ee82e49457318e068e002d21a517fa4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>NMC <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>t.sim <span class="ot">&lt;-</span> <span class="fu">replicate</span>(NMC, <span class="fu">test_stat</span>(<span class="fu">generate_data</span>(<span class="dv">25</span>, <span class="dv">10</span>)))</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(t.sim)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="R05_testing_Additional_Examples_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(t.sim);<span class="fu">var</span>(t.sim)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 9.994043</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9879012</code></pre>
</div>
</div>
<p>We want to pick a rejection threshold (a critical value) <span class="math inline">\(t_\alpha\)</span> designed to achieve a significance level (type 1 error rate) of .07. If <span class="math inline">\(\bar{X} \geq t_\alpha\)</span> we reject <span class="math inline">\(H_0\)</span>, and this should occur 7% of the time when <span class="math inline">\(H_0\)</span> is true. Rather than using the theoretical normal distribution for <span class="math inline">\(\bar{X}\)</span>, we’ll use the simulated test statistics to approximate the threshold.</p>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-5_4cc9c2cd1710a95be8ef09e8f1c866d9">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>t.crit <span class="ot">&lt;-</span> <span class="fu">quantile</span>(t.sim, .<span class="dv">93</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co">#verify</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(t.sim <span class="sc">&gt;=</span> t.crit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.07</code></pre>
</div>
</div>
<p>Let’s just make sure that if the null hypothesis is true that we end up rejecting 7%</p>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-6_4c5f9e7a540b3457b5bca128c70fb227">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>NMC){</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  nullData <span class="ot">&lt;-</span> <span class="fu">generate_data</span>(<span class="dv">25</span>, <span class="dv">10</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  result[i] <span class="ot">&lt;-</span> <span class="fu">test_stat</span>(nullData) <span class="sc">&gt;=</span> t.crit</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># result will be TRUE if the test stat is beyond the critical</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># value, ie. we reject the null</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#False otherwise</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0732</code></pre>
</div>
</div>
<p>I’m curious about the p-values you get from this test. I mean - if the null hypothesis is true, what p-values would you expect to get? Let’s repeat with the null hypothesis, and just record p-values.</p>
<p>To put it another way - Because <span class="math inline">\(T(D_0)\)</span> is a random variable, <span class="math inline">\(Pr[T(D) &gt; T(d_0)]\)</span> is a random variable as well; the <span class="math inline">\(p\)</span>-value under the null hypothesis can be thought of as a random variable and thus it has a distribution. What is the shape of this distribution? Let’s use Monte Carlo to estimate it.</p>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-7_f51f59890a5d352c59dc255f0c588a89">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>p.val <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>NMC){</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  nullData <span class="ot">&lt;-</span> <span class="fu">generate_data</span>(<span class="dv">25</span>, <span class="dv">10</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  p.val[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(t.sim <span class="sc">&gt;=</span> <span class="fu">test_stat</span>(nullData))</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(p.val)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="R05_testing_Additional_Examples_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>If the null hypothesis is true, and we get data and calculate a p-value, the p-value will be uniformly distributed according to a uniform(0,1). This turns out to be the case for ANY hypothesis test. It’s a little less precise when your test statistic is a discrete r.v., but it is more or less going to be the case.</p>
<p>What about the distribution of p-values if the mean = 11 (i.e.&nbsp;the null is false) - this is the model from which we got our initial data.</p>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-8_692c597c64db846a0c5328b792bb0e6c">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>p.val <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>NMC){</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  altData <span class="ot">&lt;-</span> <span class="fu">generate_data</span>(<span class="dv">25</span>, <span class="dv">11</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  p.val[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(t.sim <span class="sc">&gt;=</span> <span class="fu">test_stat</span>(altData))</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(p.val)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="R05_testing_Additional_Examples_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(p.val <span class="sc">&lt;=</span> <span class="fl">0.07</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.3277</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(p.val <span class="sc">&gt;</span><span class="fl">0.07</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6723</code></pre>
</div>
</div>
<p>So it seems if the data was drawn from a normal distribution with a mean of 11, we have a 32.77% probability of getting “strong evidence” to reject H_0. That’s the power of this test.</p>
</section>
<section id="achieving-exact-alpha-with-a-discrete-test-statistic-distribution" class="level2" data-number="16.2">
<h2 data-number="16.2" class="anchored" data-anchor-id="achieving-exact-alpha-with-a-discrete-test-statistic-distribution"><span class="header-section-number">16.2</span> Achieving exact alpha with a discrete test statistic distribution</h2>
<p>Going back to the example from lecture, suppose we want to achieve an exact type 1 error rate of 2.5%. We’re flipping a coin and we want to know what rejection rule we should use for the lower-bound on the number of heads - to conclude that the coin is not fair.</p>
<p>To remind you - we are flipping a coin 200 times, we have to come up with a rule such that if the flips are producing too low of heads, we reject the null hypothesis (and we would do something similar for the upper tail).</p>
<p>The goal is to find some rejection rule for low X that will reject 2.5% of the time for a fair coin.</p>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-9_3d18799dcc4a72b8fabdd3f3b3592051">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">#P (X &lt;= 85) for X~Binom(200, .5)</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pbinom</span>(<span class="dv">85</span>, <span class="dv">200</span>, .<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0200186</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">#P (X &lt;= 86) for X~Binom(200, .5)</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pbinom</span>(<span class="dv">86</span>, <span class="dv">200</span>, .<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.02798287</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">#P(X = 86)</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dbinom</span>(<span class="dv">86</span>, <span class="dv">200</span>, .<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.007964274</code></pre>
</div>
</div>
<p><span class="math display">\[P(X \leq 85) = 0.0200186\]</span></p>
<p><span class="math display">\[P(X \leq 86) = 0.02798287\]</span></p>
<p><span class="math display">\[P(X=86) = .00796\]</span></p>
<p>The idea is we will reject always when X &lt;= 85, sometimes when X = 86, and never when X &gt; 86. What do we want for the sometimes? We want <span class="math display">\[P(X \leq 85) + P(reject \cap X=86) = 0.025\]</span> In other words:</p>
<p><span class="math display">\[P(reject \cap X=86) = 0.025-P(X \leq 85)\]</span> Expanding the left hand side</p>
<p><span class="math display">\[P(reject | X=86)\cdot P(X=86) = 0.025-P(X \leq 85)\]</span> Divide both sides by <span class="math inline">\(P(X=86)\)</span> <span class="math display">\[P(reject | X=86) = \dfrac{0.025-P(X \leq 85)}{P(X=86)}\]</span></p>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-10_7a12f7d1f190f8103e5275e7d338e128">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co">#We look at the probability under H0 that we get 86 heads</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>P.reject<span class="fl">.86</span> <span class="ot">&lt;-</span> (.<span class="dv">025</span> <span class="sc">-</span> <span class="fu">pbinom</span>(<span class="dv">85</span>, <span class="dv">200</span>, .<span class="dv">5</span>) )<span class="sc">/</span><span class="fu">dbinom</span>(<span class="dv">86</span>, <span class="dv">200</span>, .<span class="dv">5</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>P.reject<span class="fl">.86</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6254687</code></pre>
</div>
</div>
<p>So if we get 86 heads, we will reject 62.5% of the time. That’s the idea.</p>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-11_a6e209183c4e1685ca0f2e6509024355">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>hack_decision_rule <span class="ot">&lt;-</span> <span class="cf">function</span>(T){</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#T is the number of heads</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(T <span class="sc">&lt;=</span> <span class="dv">85</span>){ <span class="fu">return</span> (<span class="cn">TRUE</span>)} <span class="co">#always reject if T &lt;= 85</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span>(T<span class="sc">==</span><span class="dv">86</span>) {<span class="fu">return</span>(<span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, P.reject<span class="fl">.86</span>))}</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> {<span class="fu">return</span> (<span class="cn">FALSE</span>)}</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="co">#verify that we actually are able to achieve a precise 2.5% type 1 error rate using this "hack" rule.</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>trials <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">100000</span>, <span class="dv">200</span>, .<span class="dv">5</span>)</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>reject <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100000</span>){</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>  reject[i] <span class="ot">&lt;-</span> <span class="fu">hack_decision_rule</span>(trials[i])</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(reject)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.02499</code></pre>
</div>
</div>
<p>There are two other ways that we could attempt (that come to my mind) to achieve an exact <span class="math inline">\(\alpha\)</span> with a discrete test statistic distribution.</p>
<ol type="1">
<li>If <span class="math inline">\(X \leq 86\)</span> reject <span class="math inline">\(p\)</span> of the time</li>
<li>Always reject 2.5% of the time.</li>
</ol>
<p>Both of these will attain an <span class="math inline">\(\alpha\)</span> of 0.025, but they are not as powerful (probably). Let’s consider different probabilities from 0 to .5 and compare the powers We’re only refining the rejection rule for the lower tail, so we don’t need to look at the upper tail right now.</p>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-12_72091f3b90e85ad8739118cb24f676bb">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>rule1.p <span class="ot">&lt;-</span> <span class="fl">0.025</span><span class="sc">/</span><span class="fu">pbinom</span>(<span class="dv">86</span>,<span class="dv">200</span>, .<span class="dv">5</span>)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>hack_decision_rule1 <span class="ot">&lt;-</span> <span class="cf">function</span>(T){</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(T <span class="sc">&lt;=</span> <span class="dv">86</span>){</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">runif</span>(<span class="dv">1</span>) <span class="sc">&lt;</span> rule1.p)</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">FALSE</span>)</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>hack_decision_rule2 <span class="ot">&lt;-</span> <span class="cf">function</span>(T){</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">runif</span>(<span class="dv">1</span>) <span class="sc">&lt;</span> <span class="fl">0.025</span>)</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">file.exists</span>(<span class="st">"discrete_exact_alpha.rds"</span>)){</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">#So this knits faster- load the results if they exist.</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>  discreteRR <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"discrete_exact_alpha.Rds"</span>)</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>  pseq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>,.<span class="dv">5</span>,.<span class="dv">01</span>)</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>  rr_0 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>,<span class="fu">length</span>(pseq))</span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>  rr_1 <span class="ot">&lt;-</span> rr_0</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>  rr_2 <span class="ot">&lt;-</span> rr_0</span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>  NMC <span class="ot">&lt;-</span> <span class="dv">5000</span></span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(pseq)){</span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> pseq[j]</span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>NMC){</span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>      <span class="co">#generate data</span></span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>      nheads <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">200</span>, p)</span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>      rr_0[j] <span class="ot">&lt;-</span> rr_0[j] <span class="sc">+</span> <span class="fu">hack_decision_rule</span>(nheads)</span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a>      rr_1[j] <span class="ot">&lt;-</span> rr_1[j] <span class="sc">+</span> <span class="fu">hack_decision_rule1</span>(nheads)</span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a>      rr_2[j] <span class="ot">&lt;-</span> rr_2[j] <span class="sc">+</span> <span class="fu">hack_decision_rule2</span>(nheads)</span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a>  rr_0 <span class="ot">&lt;-</span> rr_0 <span class="sc">/</span> NMC</span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a>  rr_1 <span class="ot">&lt;-</span> rr_1 <span class="sc">/</span> NMC</span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a>  rr_2 <span class="ot">&lt;-</span> rr_2 <span class="sc">/</span> NMC</span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a>  discreteRR <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(pseq, rr_0, rr_1, rr_2)</span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS</span>(discreteRR, <span class="st">"discrete_exact_alpha.rds"</span>)</span>
<span id="cb28-41"><a href="#cb28-41" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-42"><a href="#cb28-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-43"><a href="#cb28-43" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(rr_0<span class="sc">~</span>pseq, <span class="at">type=</span><span class="st">"l"</span>, <span class="at">ylab=</span><span class="st">"rejection rate"</span>, <span class="at">xlab=</span><span class="st">"Prob of H"</span>, <span class="at">main=</span><span class="st">"Power Comparison of Hack Rejection Rules"</span>, <span class="at">data=</span>discreteRR)</span>
<span id="cb28-44"><a href="#cb28-44" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="fl">0.025</span>, <span class="at">col=</span><span class="st">"red"</span>)</span>
<span id="cb28-45"><a href="#cb28-45" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x=</span>discreteRR<span class="sc">$</span>pseq, <span class="at">y=</span>discreteRR<span class="sc">$</span>rr_1, <span class="at">col=</span><span class="st">"blue"</span>)</span>
<span id="cb28-46"><a href="#cb28-46" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x=</span>discreteRR<span class="sc">$</span>pseq, <span class="at">y=</span>discreteRR<span class="sc">$</span>rr_2, <span class="at">col=</span><span class="st">"orange"</span>)</span>
<span id="cb28-47"><a href="#cb28-47" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="at">x=</span><span class="dv">0</span>, <span class="at">y=</span>.<span class="dv">6</span>, <span class="at">legend=</span><span class="fu">c</span>(<span class="st">"Hack rule"</span>, <span class="st">"reject sometimes if T&lt;=86"</span>, <span class="st">"reject sometimes"</span>), <span class="at">col=</span><span class="fu">c</span>(<span class="st">"black"</span>,<span class="st">"blue"</span>,<span class="st">"orange"</span>), <span class="at">lwd=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="R05_testing_Additional_Examples_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Compare their levels:</p>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-13_827a67d0dbef2bf3683fbc9ea40f4d65">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>rr_0[<span class="dv">51</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0256</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>rr_1[<span class="dv">51</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0252</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>rr_2[<span class="dv">51</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0262</code></pre>
</div>
</div>
</section>
<section id="example-comparing-consistency" class="level2" data-number="16.3">
<h2 data-number="16.3" class="anchored" data-anchor-id="example-comparing-consistency"><span class="header-section-number">16.3</span> Example: Comparing Consistency</h2>
<p>Student A and Student B are in the same class. We are curious to know about their academic performance, in particular their consistency in grade performance.</p>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-14_f83abc6615ce65acf20912a9c57226cc">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>A.grades <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">83.4</span>,<span class="fl">91.4</span>,<span class="fl">83.0</span>,<span class="fl">77.2</span>,<span class="fl">81.9</span>,<span class="fl">76.8</span>,<span class="fl">82.4</span>,<span class="fl">89.0</span>,<span class="fl">82.0</span>,<span class="fl">74.9</span>,<span class="fl">77.6</span>,<span class="fl">78.7</span>,<span class="fl">79.1</span>,<span class="fl">77.8</span>,<span class="fl">80.3</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>B.grades <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">75.9</span>,<span class="fl">66.4</span>,<span class="fl">98.1</span>,<span class="fl">83.0</span>,<span class="fl">72.4</span>,<span class="fl">70.6</span>,<span class="fl">67.1</span>,<span class="fl">73.0</span>,<span class="fl">89.1</span>,<span class="fl">87.0</span>,<span class="fl">83.9</span>,<span class="fl">63.7</span>,<span class="fl">88.6</span>,<span class="fl">90.0</span>,<span class="fl">75.5</span>,<span class="fl">86.5</span>,<span class="fl">77.5</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>A.grades <span class="ot">&lt;-</span> A.grades <span class="sc">-</span> <span class="fu">mean</span>(A.grades)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>B.grades <span class="ot">&lt;-</span> B.grades <span class="sc">-</span> <span class="fu">mean</span>(B.grades)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(A.grades, B.grades, <span class="at">horizontal=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="R05_testing_Additional_Examples_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The question is this: are the two students equally consistent in their grades? Let’s think about consistency in terms of variance</p>
<p>Let’s fill in the following code:</p>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-15_e49db1a6a95449eb668284aca7d1b806">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Takes in two data vectors, compares them in a meaningful way and returns a statistic that is useful to compare consistency.</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>testStat <span class="ot">&lt;-</span> <span class="cf">function</span>(dataA, dataB){</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">var</span>(dataA)<span class="sc">-</span><span class="fu">var</span>(dataB))</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="co">#This function takes in two vector, combines them, shuffles,</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="co">#And splits them</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Then calculates a test statistic</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>permuteAndCompute <span class="ot">&lt;-</span> <span class="cf">function</span>(dataA, dataB){</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>  combinedData <span class="ot">&lt;-</span> <span class="fu">c</span>(dataA, dataB)</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>  shuffledData<span class="ot">&lt;-</span> <span class="fu">sample</span>(combinedData)</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>  simA <span class="ot">&lt;-</span> shuffledData[<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(dataA)]</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>  simB <span class="ot">&lt;-</span> shuffledData[<span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(dataA))] <span class="co">#I use negative index</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">testStat</span>(simA, simB))</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a><span class="co">#Takes in the two data sets and a number of monte carlo runs. It will perform the MC simulation NMC times and it will return a distribution of test statistics.</span></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>mcDist <span class="ot">&lt;-</span> <span class="cf">function</span>(dataA, dataB, MNC){</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>  results <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>NMC){</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>    results[i] <span class="ot">&lt;-</span> <span class="fu">permuteAndCompute</span>(dataA, dataB)</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(results)</span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-16_4f2abc4dbfc053da2e96957a8612b5e4">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>obsTestStat <span class="ot">&lt;-</span> <span class="fu">testStat</span>(A.grades, B.grades)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>mcSamplingDistribution <span class="ot">&lt;-</span> <span class="fu">mcDist</span>(A.grades, B.grades, <span class="dv">10000</span>)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(mcSamplingDistribution)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span>obsTestStat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="R05_testing_Additional_Examples_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>obsTestStat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -76.26533</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(mcSamplingDistribution <span class="sc">&gt;=</span> obsTestStat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9992</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(mcSamplingDistribution <span class="sc">&lt;=</span> obsTestStat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 8e-04</code></pre>
</div>
</div>
<p>We have about .1% in the left-tail, more extreme than our observed test statitic. However the question we were investigating is “Are they equally consistent or not”</p>
<p>So - if the test statisitc was very positive (+75 or so) we would also consider that evidence for the alternative.</p>
<p>This is a two-sided test; we need to calculate probability from both sides of the distribution. What we want to do then is to follow this model:</p>
<ol type="1">
<li>calculate the probability &lt;= obs. test stat</li>
<li>calculate the probability &gt;= obs. test stat</li>
<li>take the smaller of the two</li>
<li>Double it</li>
</ol>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-17_804c658d34f6d7ef548193bb6bd38e05">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co">#This is my formula for a 2-tailed p-value</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="sc">*</span><span class="fu">min</span>(<span class="fu">mean</span>(mcSamplingDistribution<span class="sc">&gt;=</span>obsTestStat),</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mean</span>(mcSamplingDistribution<span class="sc">&lt;=</span>obsTestStat))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0016</code></pre>
</div>
</div>
<p>If this was a symmetric distribution, this would be the same as:</p>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-18_94af8810e35e212e4f226706f58e9554">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(mcSamplingDistribution<span class="sc">&gt;=</span> <span class="fu">abs</span>(obsTestStat)) <span class="sc">+</span> <span class="fu">mean</span>(mcSamplingDistribution<span class="sc">&lt;=</span> <span class="sc">-</span><span class="fu">abs</span>(obsTestStat))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.002</code></pre>
</div>
</div>
<p>Let’s suppose we used some other measure of “difference of consistency” For example, we could take the ratio of the variances.</p>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-19_6505377384515cc6592a963d35b71678">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co">#redefine the test statistic</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>testStat <span class="ot">&lt;-</span> <span class="cf">function</span>(dataA, dataB){</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">var</span>(dataA)<span class="sc">/</span><span class="fu">var</span>(dataB))</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>obsTestStat <span class="ot">&lt;-</span> <span class="fu">testStat</span>(A.grades, B.grades)</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>mcSamplingDistribution <span class="ot">&lt;-</span> <span class="fu">mcDist</span>(A.grades, B.grades, <span class="dv">10000</span>)</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(mcSamplingDistribution, <span class="at">breaks=</span><span class="dv">50</span>)</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span>obsTestStat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="R05_testing_Additional_Examples_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="sc">*</span><span class="fu">min</span>(<span class="fu">mean</span>(mcSamplingDistribution <span class="sc">&gt;=</span> obsTestStat),</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mean</span>(mcSamplingDistribution <span class="sc">&lt;=</span> obsTestStat))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.002</code></pre>
</div>
</div>
</section>
<section id="coin-flips" class="level2" data-number="16.4">
<h2 data-number="16.4" class="anchored" data-anchor-id="coin-flips"><span class="header-section-number">16.4</span> Coin Flips</h2>
<p>Below are two sequences of 300 “coin flips” (H for heads, T for tails). One of these is a true sequence of 300 independent flips of a fair coin. The other was generated by a person typing out H’s and T’s and trying to seem random. Which sequence is truly composed of coin flips?</p>
<p>Sequence 1:</p>
<p>TTHHTHTTHTTTHTTTHTTTHTTHTHHTHHTHTHHTTTHHTHTHTTHTHH TTHTHHTHTTTHHTTHHTTHHHTHHTHTTHTHTTHHTHHHTTHTHTTTHH TTHTHTHTHTHTTHTHTHHHTTHTHTHHTHHHTHTHTTHTTHHTHTHTHT THHTTHTHTTHHHTHTHTHTTHTTHHTTHTHHTHHHTTHHTHTTHTHTHT HTHTHTHHHTHTHTHTHHTHHTHTHTTHTTTHHTHTTTHTHHTHHHHTTT HHTHTHTHTHHHTTHHTHTTTHTHHTHTHTHHTHTTHTTHTHHTHTHTTT</p>
<p>Sequence 2:</p>
<p>HTHHHTHTTHHTTTTTTTTHHHTTTHHTTTTHHTTHHHTTHTHTTTTTTH THTTTTHHHHTHTHTTHTTTHTTHTTTTHTHHTHHHHTTTTTHHHHTHHH TTTTHTHTTHHHHTHHHHHHHHTTHHTHHTHHHHHHHTTHTHTTTHHTTT THTHHTTHTTHTHTHTTHHHHHTTHTTTHTHTHHTTTTHTTTTTHHTHTH HHHTTTTHTHHHTHHTHTHTHTHHHTHTTHHHTHHHHHHTHHHTHTTTHH HTTTHHTHTTHHTHHHTHTTHTTHTTTHHTHTHTTTTHTHTHTTHTHTHT</p>
<p>Useful functions: <code>flips &lt;- strsplit("HHTHTHHTHTHHHT","")</code> <code>with(rle(flips[[1]]), lengths[values=="H"])</code></p>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-20_264489cb8306333eb9141de58a592145">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>seq1 <span class="ot">=</span><span class="st">"TTHHTHTTHTTTHTTTHTTTHTTHTHHTHHTHTHHTTTHHTHTHTTHTHHTTHTHHTHTTTHHTTHHTTHHHTHHTHTTHTHTTHHTHHHTTHTHTTTHHTTHTHTHTHTHTTHTHTHHHTTHTHTHHTHHHTHTHTTHTTHHTHTHTHT THHTTHTHTTHHHTHTHTHTTHTTHHTTHTHHTHHHTTHHTHTTHTHTHTHTHTHTHHHTHTHTHTHHTHHTHTHTTHTTTHHTHTTTHTHHTHHHHTTTHHTHTHTHTHHHTTHHTHTTTHTHHTHTHTHHTHTTHTTHTHHTHTHTTT"</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>seq2 <span class="ot">=</span> <span class="st">"HTHHHTHTTHHTTTTTTTTHHHTTTHHTTTTHHTTHHHTTHTHTTTTTTHTHTTTTHHHHTHTHTTHTTTHTTHTTTTHTHHTHHHHTTTTTHHHHTHHHTTTTHTHTTHHHHTHHHHHHHHTTHHTHHTHHHHHHHTTHTHTTTHHTTTTHTHHTTHTTHTHTHTTHHHHHTTHTTTHTHTHHTTTTHTTTTTHHTHTHHHHTTTTHTHHHTHHTHTHTHTHHHTHTTHHHTHHHHHHTHHHTHTTTHH HTTTHHTHTTHHTHHHTHTTHTTHTTTHHTHTHTTTTHTHTHTTHTHTHT"</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>flips1 <span class="ot">&lt;-</span> <span class="fu">strsplit</span>(seq1,<span class="st">""</span>)</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>H.run.lengths1 <span class="ot">&lt;-</span> <span class="fu">with</span>(<span class="fu">rle</span>(flips1[[<span class="dv">1</span>]]), lengths[values<span class="sc">==</span><span class="st">"H"</span>])</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(H.run.lengths1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>H.run.lengths1
 1  2  3  4 
66 27  8  1 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>flips2 <span class="ot">&lt;-</span> <span class="fu">strsplit</span>(seq2,<span class="st">""</span>)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>H.run.lengths2 <span class="ot">&lt;-</span> <span class="fu">with</span>(<span class="fu">rle</span>(flips2[[<span class="dv">1</span>]]), lengths[values<span class="sc">==</span><span class="st">"H"</span>])</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(H.run.lengths2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>H.run.lengths2
 1  2  3  4  5  6  7  8 
45 15  9  5  1  1  1  1 </code></pre>
</div>
</div>
<p>What if we use maximum run length as a test statistic?</p>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-21_6148985a354a5a7cd660c19008a173d6">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>t.dist <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="co">#empty vector for our simulated distribution of test statistics</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>MCN <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">300</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>MCN){</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>  flips <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"H"</span>,<span class="st">"T"</span>), <span class="dv">300</span>, <span class="at">replace=</span><span class="cn">TRUE</span>)</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>  H.run.lengths <span class="ot">&lt;-</span> <span class="fu">with</span>(<span class="fu">rle</span>(flips), lengths[values<span class="sc">==</span><span class="st">"H"</span>])</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>  t.dist[i] <span class="ot">&lt;-</span> <span class="fu">max</span>(H.run.lengths)</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(t.dist)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="R05_testing_Additional_Examples_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>What are the two test statistics? We would use a 2-tailed p-value. We would consider a sequence of Hs and Ts to be weird if the max run length was too long or too short.</p>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-22_1500ff3a63fac1b921583ade127f5733">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>(t1 <span class="ot">&lt;-</span> <span class="fu">max</span>(H.run.lengths1))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="sc">*</span>(<span class="fu">min</span>(<span class="fu">mean</span>(t.dist <span class="sc">&lt;=</span> t1),<span class="fu">mean</span>(t.dist <span class="sc">&gt;=</span> t1)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0108</code></pre>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>(t2 <span class="ot">&lt;-</span> <span class="fu">max</span>(H.run.lengths2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 8</code></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="sc">*</span>(<span class="fu">min</span>(<span class="fu">mean</span>(t.dist <span class="sc">&lt;=</span> t2),<span class="fu">mean</span>(t.dist <span class="sc">&gt;=</span> t2)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8884</code></pre>
</div>
</div>
<p>It probably comes as no surprise that the first sequence of Hs and Ts is suspicious. It does not contain enough long runs of Hs- when flips are done randomly you tend to get at least some much longer runs.</p>
<p>We could repeat this with the “average” run length as well.</p>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-23_8711b5fd0d7e240f203f26db68a726fa">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>t.dist <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="co">#empty vector for our simulated distribution of test statistics</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>MCN <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">300</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>MCN){</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>  flips <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"H"</span>,<span class="st">"T"</span>), <span class="dv">300</span>, <span class="at">replace=</span><span class="cn">TRUE</span>)</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>  H.run.lengths <span class="ot">&lt;-</span> <span class="fu">with</span>(<span class="fu">rle</span>(flips), lengths[values<span class="sc">==</span><span class="st">"H"</span>])</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>  t.dist[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(H.run.lengths)</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(t.dist)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="R05_testing_Additional_Examples_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>(t1 <span class="ot">&lt;-</span> <span class="fu">mean</span>(H.run.lengths1))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.45098</code></pre>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="sc">*</span>(<span class="fu">min</span>(<span class="fu">mean</span>(t.dist <span class="sc">&lt;=</span> t1),<span class="fu">mean</span>(t.dist <span class="sc">&gt;=</span> t1)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>(t2 <span class="ot">&lt;-</span> <span class="fu">mean</span>(H.run.lengths2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.897436</code></pre>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="sc">*</span>(<span class="fu">min</span>(<span class="fu">mean</span>(t.dist <span class="sc">&lt;=</span> t2),<span class="fu">mean</span>(t.dist <span class="sc">&gt;=</span> t2)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.568</code></pre>
</div>
</div>
<p>The average run length of 1.45 would virtually never happen if a coin was actually flipped 300 times. That’s conclusive evidence that the first sequence was made up by a human.</p>
<p>What are some other test statistics that could have worked?</p>
</section>
<section id="example-hot-hands" class="level2" data-number="16.5">
<h2 data-number="16.5" class="anchored" data-anchor-id="example-hot-hands"><span class="header-section-number">16.5</span> Example: hot hands</h2>
<p>For the next example, let’s do something slightly more complicated.</p>
<p>A certain professional basketball player believes he has “<a href="https://en.wikipedia.org/wiki/Hot_hand">hot hands</a>” when shooting 3-point shots (i.e.&nbsp;if he makes a shot, he’s more likely to also make the next shot). His friend doesn’t believe him, so they make a wager and hire you, a statistician, to settle the bet.</p>
<p>As a sample, you observe the next morning as the player takes the same 3-point shot 200 times in a row (assume he is well rested, in good physical shape, and doesn’t feel significantly more tired after the experiment), so his level of mental focus doesn’t change during the experiment). You obtain the following results, where Y denotes a success and N denotes a miss:</p>
<pre><code>YNNNNYYNNNYNNNYYYNNNNNYNNNNNNNNNYNNNNNYYNYYNNNYNNNNYNNYYYYNNYY
NNNNNNNNNNNNNNNYYYNNNYYYYNNNNNYNYYNNNNYNNNNNNYNNNYNNYNNNNNYNYY
YNNYYYNYNNNNYNNNNNNNYYNNYYNNNNNNYNNNYNNNNNNNNYNNNYNNNNNYYNNNNN
NYYYYYYNYYNNYN</code></pre>
<p>The hypotheses being tested are: <span class="math inline">\(H_0:\)</span> there is no hot hand effect - shots are independent <span class="math inline">\(H_A:\)</span> there is some dependency between shots</p>
<p>Note that the existence of a “hot hands” effect means the shots are not independent. Also note that there’s a third possibility: that the player is more likely to “<a href="https://en.wikipedia.org/wiki/Choke_(sports)">choke</a>” and miss the next shot if he scored the previous one (e.g.&nbsp;maybe scoring a shot makes him feel more nervous because he feels like he’s under pressure).</p>
<section id="attempt-1-run-length" class="level3" data-number="16.5.1">
<h3 data-number="16.5.1" class="anchored" data-anchor-id="attempt-1-run-length"><span class="header-section-number">16.5.1</span> Attempt 1: run length</h3>
<p>Since the existence of a hot hands effect tends to increase the run lengths of <code>Y</code>s compared to if the shots were independent, we can use the longest run length as a way of comparing independence vs hot hands (note if the player is a choker, they will tend to have shorter runs of <code>Y</code>s than if they were independent, so you can simply ignore this case for now and compare hot hands v. independence for simplicity).</p>
<p>Now, how exactly do you compare these two situations and determine which is a better fit for the data?</p>
<p>One thing that’s worth noting is that <strong><em>if a sequence of repeated experiments is independent, then it shouldn’t matter what order the results are in</em></strong>. This should be fairly easy to understand and agree with.</p>
<p>Let’s <strong><em>assume that the throws are totally independent</em></strong>. Recall we also assume he doesn’t get tired so his baseline shot-making ability doesn’t change over the course of the experiment. Therefore, we should be able to (under these assumptions) <strong><em>arbitrarily reorder his shots without affecting any statistical properties of his shot sequence</em></strong>. So let’s do that!</p>
<p>We begin by parsing the throws into a vector of <code>Y</code> and <code>N</code>.</p>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-24_ab2f955282e2ba1c9009bc83611b6783">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># the sequence of throws is broken up into 4 chunks for readability, then</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="co"># paste0 is used to merge them into a single sequence, then</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="co"># strplit("YN...N",split="") is used to split the string at every "", so</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="co"># we get a vector of each character, and finally</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="co"># [[1]] is used to get the vector itself (strsplit actually outputs a list</span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a><span class="co"># with the vector as the first element; [[1]] removes the list wrapper)</span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a><span class="co"># for more info about the strsplit function, see</span></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a><span class="co"># https://www.journaldev.com/43001/strsplit-function-in-r</span></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>throws <span class="ot">=</span> <span class="fu">strsplit</span>(</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>   <span class="fu">paste0</span>(<span class="st">"YNNNNYYNNNYNNNYYYNNNNNYNNNNNNNNNYNNNNNYYNYYNNNYNNN"</span>,</span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a>          <span class="st">"NYNNYYYYNNYYNNNNNNNNNNNNNNNYYYNNNYYYYNNNNNYNYYNNNN"</span>,</span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a>          <span class="st">"YNNNNNNYNNNYNNYNNNNNYNYYYNNYYYNYNNNNYNNNNNNNYYNNYY"</span>,</span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a>          <span class="st">"NNNNNNYNNNYNNNNNNNNYNNNYNNNNNYYNNNNNNYYYYYYNYYNNYN"</span>), <span class="at">split=</span><span class="st">""</span>)[[<span class="dv">1</span>]]</span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a>throws</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] "Y" "N" "N" "N" "N" "Y" "Y" "N" "N" "N" "Y" "N" "N" "N" "Y" "Y" "Y" "N"
 [19] "N" "N" "N" "N" "Y" "N" "N" "N" "N" "N" "N" "N" "N" "N" "Y" "N" "N" "N"
 [37] "N" "N" "Y" "Y" "N" "Y" "Y" "N" "N" "N" "Y" "N" "N" "N" "N" "Y" "N" "N"
 [55] "Y" "Y" "Y" "Y" "N" "N" "Y" "Y" "N" "N" "N" "N" "N" "N" "N" "N" "N" "N"
 [73] "N" "N" "N" "N" "N" "Y" "Y" "Y" "N" "N" "N" "Y" "Y" "Y" "Y" "N" "N" "N"
 [91] "N" "N" "Y" "N" "Y" "Y" "N" "N" "N" "N" "Y" "N" "N" "N" "N" "N" "N" "Y"
[109] "N" "N" "N" "Y" "N" "N" "Y" "N" "N" "N" "N" "N" "Y" "N" "Y" "Y" "Y" "N"
[127] "N" "Y" "Y" "Y" "N" "Y" "N" "N" "N" "N" "Y" "N" "N" "N" "N" "N" "N" "N"
[145] "Y" "Y" "N" "N" "Y" "Y" "N" "N" "N" "N" "N" "N" "Y" "N" "N" "N" "Y" "N"
[163] "N" "N" "N" "N" "N" "N" "N" "Y" "N" "N" "N" "Y" "N" "N" "N" "N" "N" "Y"
[181] "Y" "N" "N" "N" "N" "N" "N" "Y" "Y" "Y" "Y" "Y" "Y" "N" "Y" "Y" "N" "N"
[199] "Y" "N"</code></pre>
</div>
</div>
<p>Next, we write a function to get the longest run of <code>Y</code>s in the throw sequence. Here we use a convenient function called <code>rle( )</code> which is short for <a href="https://en.wikipedia.org/wiki/Run-length_encoding">run length encoding</a>, which turns our sequence of throws into sequences of runs (e.g.&nbsp;YNNNNYYNNNY becomes something like “1 <code>Y</code>, 4 <code>N</code>s, 2 <code>Y</code>s, 3 <code>N</code>s, and 1 <code>Y</code>”). We can then simply take the longest of the <code>Y</code> runs.</p>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-25_45b31bc744dca7eeae6597ff54a11328">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>longestRun <span class="ot">=</span> <span class="cf">function</span>(x, <span class="at">target =</span> <span class="st">'Y'</span>){</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">max</span>(<span class="dv">0</span>, <span class="fu">with</span>(<span class="fu">rle</span>(x), lengths[values<span class="sc">==</span>target]))</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a><span class="fu">longestRun</span>(throws)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6</code></pre>
</div>
</div>
<p>Now, we randomly shuffle the sequence of throws many times and see what the longest <code>Y</code> runs look like for these shuffled sequences.</p>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-26_7366bfb09ff25a1ec497ec381c86c209">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set number of reps to use</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>MCN <span class="ot">=</span> <span class="dv">10000</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a><span class="co"># create vector to save results in</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>mc.runs <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>,MCN)</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a><span class="co"># for each rep, randomize sequence and find longest run of Y</span></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>MCN){</span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>    mc.runs[i] <span class="ot">=</span> <span class="fu">longestRun</span>(<span class="fu">sample</span>(throws))</span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-27_cfb17992789e0b063ddf5f9eae289195">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">max.print=</span><span class="dv">50</span>)</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>mc.runs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 4 4 6 5 6 3 4 4 5 6 4 4 3 3 4 3 5 5 4 3 4 6 5 4 3 5 4 4 4 3 4 4 4 4 6 4 5 5
[39] 5 6 4 5 3 6 6 8 4 4 5 6
 [ reached getOption("max.print") -- omitted 9950 entries ]</code></pre>
</div>
</div>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-28_b3b0474d02e005964bd8559264cf67c1">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(<span class="fu">table</span>(mc.runs))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="R05_testing_Additional_Examples_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>For a two tailed test - if you would reject the null hypothesis if the test statistic lived in either the upper or the lower tail of the distribution, a general rule to use is to take the proportion &gt;= observed and &lt;= observed, whichever one is smaller, double that.</p>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-29_50ee513ebdb190f32c97e68b98161261">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(mc.runs <span class="sc">&gt;=</span> <span class="dv">6</span>) <span class="sc">*</span> <span class="dv">2</span> <span class="co">#because it's a 2 tailed test</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2128</code></pre>
</div>
</div>
<p>Compared to other shuffled sequences, our run length doesn’t seem that unlikely. Therefore, this method seems inconclusive.</p>
<p>Can we find an even better “statistic” to use?</p>
</section>
<section id="attempt-2-running-odds-ratio" class="level3" data-number="16.5.2">
<h3 data-number="16.5.2" class="anchored" data-anchor-id="attempt-2-running-odds-ratio"><span class="header-section-number">16.5.2</span> Attempt 2: running odds ratio</h3>
<p>Consider <strong>every pair of consecutive throws</strong> and make a table of the outcomes. For example, the first 8 throws in the sequence are YNNNNYYN. Breaking this into consecutive pairs, we have YN, NN, NN, NN, NY, YY, YN. This gives the table:</p>
<center>
<div style="width:100px;">
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;">NN</th>
<th style="text-align: center;">NY</th>
<th style="text-align: center;">YN</th>
<th style="text-align: center;">YY</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">3</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">1</td>
</tr>
</tbody>
</table>
</div>
</center>
<p>Suppose we do this for the entire sequence of 200 throws (note this gives you 199 pairs). If we <strong>divide the number of NY by the number of NN</strong>, we get an estimate for <strong>how much <em>more</em> likely he is to make the next shot <em>assuming he missed his last shot</em></strong>.</p>
<p>Similarly, we can <strong>divide the number of YY by the number of YN</strong> to get an estimate for <strong>how much <em>more</em> likely he is to make the next shot <em>assuming he scored his last shot</em></strong>.</p>
<p>Now, note that <strong>if the “hot hands” effect really exists</strong> in the data, then <strong>YY/YN should be larger than NY/NN</strong> in a large enough sample. We use this fact to define the following quantity:</p>
<p><span class="math display">\[R=\frac{(\text{# of YY})/(\text{# of YN})}{(\text{# of NY})/(\text{# of NN})}\]</span></p>
<p>The ratio <span class="math inline">\(R\)</span> represents, in some sense, <strong>how much more likely</strong> the player is to <strong>make the next shot</strong> if he <strong>made the previous shot <em>vs</em> if he didn’t make the previous shot</strong> (note the <strong><em>vs</em></strong>). This is exactly what we’re trying to investigate!</p>
<p>If there is a “hot hands” effect, the numerator should be greater than the denominator and we should have <span class="math inline">\(R&gt;1\)</span>. If the throws are independent and do not affect each other then in theory we should have <span class="math inline">\(R=1\)</span>. If the player is actually a choker (i.e.&nbsp;he is more likely to miss after a successful shot), then we should have <span class="math inline">\(R&lt;1\)</span>. (Side note: this is basically an <a href="https://journalfeed.org/article-a-day/2018/idiots-guide-to-odds-ratios">odds ratio</a>).</p>
<p>Now, we can use the same general method as the first attempt. If we assume his throws are independent and his shot probability doesn’t change significantly during the experiment, then we can randomly shuffle his throws and no properties should change. So let’s do that!</p>
<p>First, I wrote a function to split the sequence of throws into consecutive pairs and then tabulates them.</p>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-30_27c18b13b41100551d82f656d66e1e8b">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define function for tabulating consecutive pairs</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>tableOfPairs <span class="ot">=</span> <span class="cf">function</span>(x) {n<span class="ot">=</span><span class="fu">length</span>(x);Rfast<span class="sc">::</span><span class="fu">Table</span>(<span class="fu">paste</span>(x[<span class="dv">1</span><span class="sc">:</span>(n<span class="dv">-1</span>)],x[<span class="dv">2</span><span class="sc">:</span>n],<span class="at">sep=</span><span class="st">""</span>))}</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a><span class="co"># test function for correct output</span></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tableOfPairs</span>(<span class="fu">strsplit</span>(<span class="st">"YNNNNYYN"</span>,<span class="at">split=</span><span class="st">""</span>)[[<span class="dv">1</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>NN NY YN YY 
 3  1  2  1 </code></pre>
</div>
</div>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-31_fb97b993c9dcadb781cf2d9c1bb84242">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># run function on original sequence of throws</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tableOfPairs</span>(throws)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> NN  NY  YN  YY 
102  34  35  28 </code></pre>
</div>
</div>
<p>Next, I wrote a function that takes the above table as an input and returns the ratio R as defined above.</p>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-32_5054e8c7b3a0b4934b49d65e5ad187bb">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>ratioFromTable <span class="ot">=</span> <span class="cf">function</span>(tb) <span class="fu">setNames</span>((tb[<span class="st">"YY"</span>]<span class="sc">/</span>tb[<span class="st">"YN"</span>])<span class="sc">/</span>(tb[<span class="st">"NY"</span>]<span class="sc">/</span>tb[<span class="st">"NN"</span>]),<span class="st">"R"</span>)</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a><span class="co"># run on our data</span></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ratioFromTable</span>(<span class="fu">tableOfPairs</span>(throws))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  R 
2.4 </code></pre>
</div>
</div>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-33_4532bd66732378e4c8926d3944cc99f3">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># we can check this is correct by manually computing it</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>(<span class="dv">28</span><span class="sc">/</span><span class="dv">35</span>)<span class="sc">/</span>(<span class="dv">34</span><span class="sc">/</span><span class="dv">102</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.4</code></pre>
</div>
</div>
<p>Now we just need to shuffle the sequence and see what this ratio looks like for other sequences.</p>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-34_0f295543a9938a66e4bfb1903090be1d">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set number of reps to use</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>N <span class="ot">=</span> <span class="dv">10000</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a><span class="co"># create another vector to save results in</span></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>mc.ratios <span class="ot">=</span> <span class="fu">rep</span>(<span class="cn">NA</span>,N)</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a><span class="co"># for each rep, randomize sequence and find ratio R</span></span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a><span class="co">#for(i in 1:N){</span></span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a><span class="co">#    mc.ratios[i] = ratioFromTable(tableOfPairs(sample(throws)))</span></span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a><span class="co">#}</span></span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a><span class="co"># alternatively, use replicate</span></span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a>mc.ratios <span class="ot">=</span> <span class="fu">replicate</span>(N,<span class="fu">ratioFromTable</span>(<span class="fu">tableOfPairs</span>(<span class="fu">sample</span>(throws))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-35_fa495a1e92e95c98722d00f1d39f2396">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">max.print=</span><span class="dv">50</span>)</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(mc.ratios,<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   R    R    R    R    R    R    R    R    R    R    R    R    R    R    R    R 
0.84 0.84 2.16 0.64 0.90 0.67 1.59 1.43 0.81 1.88 0.84 1.43 0.90 0.93 1.43 2.31 
   R    R    R    R    R    R    R    R    R    R    R    R    R    R    R    R 
1.53 0.75 0.93 1.59 1.24 1.43 1.29 1.29 1.95 1.01 0.81 1.20 1.29 0.51 0.39 0.97 
   R    R    R    R    R    R    R    R    R    R    R    R    R    R    R    R 
0.75 1.29 0.57 0.93 0.75 1.12 1.24 0.64 0.93 1.04 1.95 0.93 1.53 0.57 0.67 0.48 
   R    R 
0.97 1.70 
 [ reached getOption("max.print") -- omitted 9950 entries ]</code></pre>
</div>
</div>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-36_40ad2927d0ed4a05539420b0f80383be">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(mc.ratios, <span class="at">breaks=</span><span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="R05_testing_Additional_Examples_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-37_262bf369cb51e37a8e82c529ba3dbf1e">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(mc.ratios<span class="sc">&gt;=</span><span class="fu">ratioFromTable</span>(<span class="fu">tableOfPairs</span>(throws)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0023</code></pre>
</div>
</div>
<p>Now we can see our original ratio of <span class="math inline">\(R=2.4\)</span> seems extremely unlikely! In particular, most of the shuffled statistics are centered around 1 (which is what we expect, since we established <span class="math inline">\(R=1\)</span> for independent sequences).</p>
<p>This method (which is a little more refined than the simpler run length method) appears to show that our original sequence isn’t well explained by the throws being independent. Since <span class="math inline">\(R=2.4\gg1\)</span> and this result appears unlikely to happen under independence, we may conclude <strong>the player does actually have hot hands</strong>.</p>
</section>
</section>
<section id="permutation-test-drug-trials-extended" class="level2" data-number="16.6">
<h2 data-number="16.6" class="anchored" data-anchor-id="permutation-test-drug-trials-extended"><span class="header-section-number">16.6</span> Permutation test: Drug Trials (Extended)</h2>
<p>Apologies- this part of the document is a little messy, I have to remove duplicate work!</p>
<p>The results from a medical trial; larger numbers are “better” We want to know if there is evidence that the drug (treatment group) performs on average better than control.</p>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-38_10951e9603c407edce8e20fcea8aecd8">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>control <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.10</span>, <span class="sc">-</span><span class="fl">0.55</span>, <span class="fl">1.24</span>, <span class="sc">-</span><span class="fl">0.97</span>, <span class="sc">-</span><span class="fl">0.76</span>,  <span class="fl">0.21</span>,<span class="sc">-</span><span class="fl">0.27</span>, <span class="sc">-</span><span class="fl">1.02</span>, <span class="fl">0.58</span>, <span class="fl">1.67</span>, <span class="sc">-</span><span class="fl">1.07</span>, <span class="fl">0.17</span>, <span class="fl">1.45</span>, <span class="fl">0.34</span>, <span class="fl">1.15</span>, <span class="fl">0.18</span>, <span class="sc">-</span><span class="fl">0.97</span>, <span class="fl">0.43</span>, <span class="sc">-</span><span class="fl">1.39</span>, <span class="sc">-</span><span class="fl">2.76</span> );</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>treatment <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="fl">0.54</span>, <span class="fl">0.36</span>, <span class="fl">0.59</span>, <span class="sc">-</span><span class="fl">0.57</span>, <span class="fl">0.53</span>, <span class="sc">-</span><span class="fl">0.78</span>, <span class="sc">-</span><span class="fl">0.44</span>, <span class="sc">-</span><span class="fl">0.98</span>, <span class="fl">1.31</span>, <span class="fl">0.50</span>, <span class="fl">0.57</span>, <span class="fl">0.49</span>, <span class="sc">-</span><span class="fl">0.96</span>, <span class="fl">2.41</span>, <span class="fl">0.85</span>, <span class="fl">1.93</span>, <span class="fl">0.95</span>, <span class="fl">1.45</span>, <span class="fl">1.61</span>, <span class="sc">-</span><span class="fl">1.16</span> );</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(treatment, control)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="R05_testing_Additional_Examples_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Think about the logic of how a monte carlo test would work. We need to come up with a null model corresponding with the null hypothesis - but we really should be clear about the hypothesis that we’re testing.</p>
<p>Claim (alt hypothesis) - the drug works. Null hypothesis - the drug does not work.</p>
<p>The null model implies - these 40 values just happened to be partitioned randomly into control group and treatment group.</p>
<p>So in a Monte Carlo simulation, we can take these 40 values, shuffle them around, and re-partition them into “control” and “Treatment”</p>
<p>The second important decision we have to make: on each simulation of the data we need to calculate some statistic or number - some function of the data - that captures the… unusualness of it somehow. Something that would lend evidence towards the alt. hypothesis.</p>
<p>The alt hypothesis (“the drug works”) - evidence in support of this would be: the mean for the treatment group &gt; the mean for the control group.</p>
<p>One idea: Our test statistic could be “TRUE/FALSE is the mean_Trt &gt; mean_Cntrl”</p>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-39_80cf82baf3d8072cbe36be3de96e896e">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Create a test_statistic function</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>testStat <span class="ot">&lt;-</span> <span class="cf">function</span>(dataA, dataB){</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#true if mean dataA &gt; mean dataB</span></span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#return(mean(dataA) &gt; mean(dataB)) </span></span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Oops that doesn't work well, because it's only TRUE or FALSE</span></span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">mean</span>(dataA)<span class="sc">-</span><span class="fu">mean</span>(dataB))</span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now let’s get the test statistic for the observed data:</p>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-40_d99006a4dafc9ea862d04c0744dbe127">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">testStat</span>(treatment, control)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.582</code></pre>
</div>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co">#MC simulation</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>NMC <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>NMC){</span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#We need to re-partition the data into two groups.</span></span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>  combinedData <span class="ot">&lt;-</span> <span class="fu">c</span>(treatment, control)</span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#we next get 'simulated' treatment and control data</span></span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>  shuffledData<span class="ot">&lt;-</span> <span class="fu">sample</span>(combinedData)</span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a>  treatmentSim <span class="ot">&lt;-</span> shuffledData[<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(treatment)]</span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a>  controlSim <span class="ot">&lt;-</span> shuffledData[<span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(treatment))]</span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a>  results[i] <span class="ot">&lt;-</span> <span class="fu">testStat</span>(treatmentSim, controlSim)</span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="R05_testing_Additional_Examples_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Recall the alternative hypothesis:</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a><span class="co"># The drug works</span></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a><span class="co"># We only would consider evidence of this if the meanT-meanC &gt;0</span></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a><span class="co"># So we only are going to calculate a p-value from the upper-tail</span></span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a><span class="co"># of the distribution.</span></span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(results <span class="sc">&gt;=</span> <span class="fu">testStat</span>(treatment, control))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0445</code></pre>
</div>
</div>
<p>It might be interesting to check what a parametric T test would give us.</p>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-41_0d29847e7e7cf3972db01f2c4e9d800b">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(treatment, control, <span class="at">var.equal=</span><span class="cn">TRUE</span>, <span class="at">alternative=</span><span class="st">"greater"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Two Sample t-test

data:  treatment and control
t = 1.7437, df = 38, p-value = 0.04465
alternative hypothesis: true difference in means is greater than 0
95 percent confidence interval:
 0.01928295        Inf
sample estimates:
mean of x mean of y 
    0.460    -0.122 </code></pre>
</div>
</div>
<p>Some other test statistics we could possibly use:</p>
<ul>
<li>difference of the medians</li>
<li>difference of the max values</li>
</ul>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-42_9138c643db7fc317d6b7a0c6af126997">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Create a test_statistic function</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>testStat <span class="ot">&lt;-</span> <span class="cf">function</span>(dataA, dataB){</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">max</span>(dataA)<span class="sc">-</span><span class="fu">max</span>(dataB))</span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>permute_and_compute <span class="ot">&lt;-</span> <span class="cf">function</span>( treatment, control ){</span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>    combinedData <span class="ot">&lt;-</span> <span class="fu">c</span>(treatment, control)</span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>    shuffledData<span class="ot">&lt;-</span> <span class="fu">sample</span>(combinedData)</span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a>    treatmentSim <span class="ot">&lt;-</span> shuffledData[<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(treatment)]</span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a>    controlSim <span class="ot">&lt;-</span> shuffledData[<span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(treatment))]</span>
<span id="cb107-11"><a href="#cb107-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">testStat</span>(treatmentSim, controlSim))</span>
<span id="cb107-12"><a href="#cb107-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb107-13"><a href="#cb107-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-14"><a href="#cb107-14" aria-hidden="true" tabindex="-1"></a>NMC <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb107-15"><a href="#cb107-15" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb107-16"><a href="#cb107-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>NMC){</span>
<span id="cb107-17"><a href="#cb107-17" aria-hidden="true" tabindex="-1"></a>  results[i] <span class="ot">&lt;-</span> <span class="fu">permute_and_compute</span>(treatment, control)</span>
<span id="cb107-18"><a href="#cb107-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb107-19"><a href="#cb107-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-20"><a href="#cb107-20" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(results, <span class="at">breaks=</span><span class="dv">50</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="R05_testing_Additional_Examples_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(results <span class="sc">&gt;=</span> <span class="fu">testStat</span>(treatment, control))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2461</code></pre>
</div>
</div>
<p>What if we use a different test statistic? Let’s compare the medians.</p>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-43_4b2f12619431b2ef449e5ba033dc50e7">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>testStat <span class="ot">&lt;-</span> <span class="cf">function</span>(A,B){</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">median</span>(A)<span class="sc">-</span><span class="fu">median</span>(B))</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a><span class="co">#rerun comparing the sample medians</span></span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>test_statistics <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a>(Tobsd <span class="ot">&lt;-</span> <span class="fu">testStat</span>(treatment, control))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>NMC ) {</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>  test_statistics[i] <span class="ot">&lt;-</span> <span class="fu">permute_and_compute</span>( treatment, control );</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>( test_statistics, <span class="at">breaks=</span><span class="dv">60</span> )</span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>( <span class="at">v=</span>Tobsd, <span class="at">lw=</span><span class="dv">3</span>, <span class="at">col=</span><span class="st">'red'</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="R05_testing_Additional_Examples_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(test_statistics <span class="sc">&gt;=</span> Tobsd)<span class="sc">/</span>NMC</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0912</code></pre>
</div>
</div>
<p>Let’s use KS test statistics - the max deviance between their empirical distributions!=</p>
<p>what is that?</p>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-44_7fdf9f54009bedf88e9485b78309fb35">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>compare <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(x); m <span class="ot">&lt;-</span> <span class="fu">length</span>(y)</span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>  w <span class="ot">&lt;-</span> <span class="fu">c</span>(x, y)</span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>  o <span class="ot">&lt;-</span> <span class="fu">order</span>(w)</span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>  z <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(<span class="fu">ifelse</span>(o <span class="sc">&lt;=</span> n, m, <span class="sc">-</span>n))</span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a>  i <span class="ot">&lt;-</span> <span class="fu">which.max</span>(<span class="fu">abs</span>(z))</span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a>  w[o[i]]</span>
<span id="cb115-8"><a href="#cb115-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb115-9"><a href="#cb115-9" aria-hidden="true" tabindex="-1"></a>u<span class="ot">&lt;-</span><span class="fu">compare</span>(treatment, control) <span class="co">#this is where the max difference occurs</span></span>
<span id="cb115-10"><a href="#cb115-10" aria-hidden="true" tabindex="-1"></a><span class="fu">abs</span>(<span class="fu">mean</span>(treatment <span class="sc">&lt;</span> u) <span class="sc">-</span> <span class="fu">mean</span>(control <span class="sc">&lt;</span> u))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.35</code></pre>
</div>
</div>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-45_5ef3fdfec0e94716ea2846b55685a52d">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>ecdf1 <span class="ot">&lt;-</span> <span class="fu">ecdf</span>(treatment)</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>ecdf2 <span class="ot">&lt;-</span> <span class="fu">ecdf</span>(control)</span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ecdf1, <span class="at">verticals=</span><span class="cn">TRUE</span>, <span class="at">do.points=</span><span class="cn">FALSE</span>, <span class="at">col=</span><span class="st">"blue"</span>, <span class="at">main=</span><span class="st">"Compare ecdfs"</span>)</span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ecdf2, <span class="at">verticals=</span><span class="cn">TRUE</span>, <span class="at">do.points=</span><span class="cn">FALSE</span>, <span class="at">add=</span><span class="cn">TRUE</span>, <span class="at">col=</span><span class="st">'red'</span>)</span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">c</span>(u,u), <span class="fu">c</span>(<span class="fu">ecdf1</span>(u), <span class="fu">ecdf2</span>(u)), <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="at">x=</span><span class="fu">min</span>(control,treatment), <span class="at">y=</span><span class="dv">1</span>, <span class="at">legend=</span><span class="fu">c</span>(<span class="st">"treatment"</span>,<span class="st">"control"</span>), <span class="at">col=</span><span class="fu">c</span>(<span class="st">"blue"</span>,<span class="st">"red"</span>), <span class="at">lty=</span><span class="dv">1</span>, <span class="at">xjust=</span><span class="sc">-</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="R05_testing_Additional_Examples_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We can pull this out from the built-in <code>ks.test</code> function. The test statistic is the max deviance between the two empirical CDFs</p>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-46_e25f57ff449f46ff50cde1fca8b8717c">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>testStat <span class="ot">&lt;-</span> <span class="cf">function</span>(A,B){</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">as.numeric</span>(<span class="fu">ks.test</span>(A,B)[<span class="dv">1</span>]))</span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a><span class="fu">testStat</span>(treatment, control)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.4</code></pre>
</div>
</div>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-47_75e6e1828f58b285708567ca90edf8c0">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="co">#rerun</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>(Tobsd <span class="ot">&lt;-</span> <span class="fu">testStat</span>(treatment, control))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>test_statistics <span class="ot">&lt;-</span> <span class="fu">rep</span>( <span class="dv">0</span>, NMC ); <span class="co"># Vector to store our "fake" test statistics</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>NMC ) {</span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>  test_statistics[i] <span class="ot">&lt;-</span> <span class="fu">permute_and_compute</span>( treatment, control );</span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>( test_statistics )</span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>( <span class="at">v=</span>Tobsd, <span class="at">lw=</span><span class="dv">3</span>, <span class="at">col=</span><span class="st">'red'</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="R05_testing_Additional_Examples_files/figure-html/unnamed-chunk-47-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(test_statistics <span class="sc">&gt;=</span> Tobsd)<span class="sc">/</span>NMC</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0839</code></pre>
</div>
</div>
<p>We can spend all our time picking different test statistics, and maybe we find one that gives us a low p-value for this data set. But we have to be careful that it would generalize well to other datasets. Furthermore, we want to make sure that it would not be giving us false positives if we were comparing two populations that really did have the same distribution</p>
<p>Let’s demonstrate this comparing our 3 test statistics:</p>
<ul>
<li>difference of means</li>
<li>difference of maximums</li>
<li>difference of medians</li>
<li>max ecdf deviation</li>
</ul>
<p>And we can compare them over datasets that are generated from increasingly different populations.</p>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-48_152a59514cbd890e3eace95b8bcabb26">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>generate_experiment <span class="ot">&lt;-</span> <span class="cf">function</span>(nA, nB, effectSize){</span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#we will assume that the values in our data are drawn from a distribution - </span></span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#here we'll use a normal distribution. We could use permutation methods but </span></span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#that doesn't really change the point we're trying to make.</span></span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="fu">rnorm</span>(nA, <span class="at">mean=</span>effectSize, <span class="at">sd=</span><span class="dv">1</span>),</span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a>              <span class="fu">rnorm</span>(nB, <span class="at">mean=</span><span class="dv">0</span>, <span class="at">sd=</span><span class="dv">1</span>)))</span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb125-8"><a href="#cb125-8" aria-hidden="true" tabindex="-1"></a><span class="co">#for example</span></span>
<span id="cb125-9"><a href="#cb125-9" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_experiment</span>(<span class="dv">20</span>,<span class="dv">20</span>,.<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
 [1]  0.01778166  1.65018162  1.18477818 -1.57641934 -0.64161057  0.08577461
 [7]  1.17349869 -0.47823398 -0.26032160 -0.93443191  2.05777102 -0.84094665
[13]  2.32726497  0.03211071  1.11730385 -0.27515971  0.35877537 -0.59002849
[19]  0.68524808  0.39028353

[[2]]
 [1] -0.78766069  0.47220868  1.80632883 -0.50308343  1.82997227 -1.65046780
 [7]  0.18774042  1.89357611 -0.85911026  1.78447769 -0.06779853 -0.42485180
[13] -1.36963966  0.95244591  0.30041995 -0.57886123 -0.35174480 -1.13007872
[19]  0.49605029  1.07811514</code></pre>
</div>
</div>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-49_e30703393ebf6cb12bc0b39c361f8d6d">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>nDatasets <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>NMC <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a>effects <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,.<span class="dv">1</span>)</span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a>rr.mean <span class="ot">&lt;-</span> <span class="dv">0</span>; rr.max <span class="ot">&lt;-</span> <span class="dv">0</span>; rr.median <span class="ot">&lt;-</span><span class="dv">0</span>; rr.ks <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(effects)){</span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true" tabindex="-1"></a>  effect <span class="ot">&lt;-</span> effects[k]</span>
<span id="cb127-8"><a href="#cb127-8" aria-hidden="true" tabindex="-1"></a>  rej.mean <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">FALSE</span>,nDatasets)</span>
<span id="cb127-9"><a href="#cb127-9" aria-hidden="true" tabindex="-1"></a>  rej.max <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">FALSE</span>,nDatasets)</span>
<span id="cb127-10"><a href="#cb127-10" aria-hidden="true" tabindex="-1"></a>  rej.median <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">FALSE</span>,nDatasets)</span>
<span id="cb127-11"><a href="#cb127-11" aria-hidden="true" tabindex="-1"></a>  rej.ks <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">FALSE</span>,nDatasets)</span>
<span id="cb127-12"><a href="#cb127-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">#generate 100 different datasets</span></span>
<span id="cb127-13"><a href="#cb127-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nDatasets){</span>
<span id="cb127-14"><a href="#cb127-14" aria-hidden="true" tabindex="-1"></a>    exp.data <span class="ot">&lt;-</span> <span class="fu">generate_experiment</span>(<span class="dv">20</span>,<span class="dv">20</span>,effect)</span>
<span id="cb127-15"><a href="#cb127-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb127-16"><a href="#cb127-16" aria-hidden="true" tabindex="-1"></a>    obs.mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(exp.data[[<span class="dv">1</span>]])<span class="sc">-</span><span class="fu">mean</span>(exp.data[[<span class="dv">2</span>]])</span>
<span id="cb127-17"><a href="#cb127-17" aria-hidden="true" tabindex="-1"></a>    obs.median <span class="ot">&lt;-</span> <span class="fu">median</span>(exp.data[[<span class="dv">1</span>]])<span class="sc">-</span><span class="fu">median</span>(exp.data[[<span class="dv">2</span>]])</span>
<span id="cb127-18"><a href="#cb127-18" aria-hidden="true" tabindex="-1"></a>    obs.max <span class="ot">&lt;-</span> <span class="fu">max</span>(exp.data[[<span class="dv">1</span>]])<span class="sc">-</span><span class="fu">max</span>(exp.data[[<span class="dv">2</span>]])</span>
<span id="cb127-19"><a href="#cb127-19" aria-hidden="true" tabindex="-1"></a>    obs.ks <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">ks.test</span>(exp.data[[<span class="dv">1</span>]],exp.data[[<span class="dv">2</span>]])[<span class="dv">1</span>])</span>
<span id="cb127-20"><a href="#cb127-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb127-21"><a href="#cb127-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">#permute and compute 1000 times</span></span>
<span id="cb127-22"><a href="#cb127-22" aria-hidden="true" tabindex="-1"></a>    t.means <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb127-23"><a href="#cb127-23" aria-hidden="true" tabindex="-1"></a>    t.medians <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb127-24"><a href="#cb127-24" aria-hidden="true" tabindex="-1"></a>    t.maxes <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb127-25"><a href="#cb127-25" aria-hidden="true" tabindex="-1"></a>    t.kss <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb127-26"><a href="#cb127-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>NMC){</span>
<span id="cb127-27"><a href="#cb127-27" aria-hidden="true" tabindex="-1"></a>      shuffledData <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(exp.data[[<span class="dv">1</span>]],exp.data[[<span class="dv">2</span>]]))</span>
<span id="cb127-28"><a href="#cb127-28" aria-hidden="true" tabindex="-1"></a>      simA <span class="ot">&lt;-</span> shuffledData[<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(exp.data[[<span class="dv">1</span>]])]</span>
<span id="cb127-29"><a href="#cb127-29" aria-hidden="true" tabindex="-1"></a>      simB <span class="ot">&lt;-</span> shuffledData[<span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(exp.data[[<span class="dv">1</span>]]))]</span>
<span id="cb127-30"><a href="#cb127-30" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb127-31"><a href="#cb127-31" aria-hidden="true" tabindex="-1"></a>      t.means[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(simA)<span class="sc">-</span><span class="fu">mean</span>(simB)</span>
<span id="cb127-32"><a href="#cb127-32" aria-hidden="true" tabindex="-1"></a>      t.medians[i] <span class="ot">&lt;-</span> <span class="fu">median</span>(simA)<span class="sc">-</span><span class="fu">median</span>(simB)</span>
<span id="cb127-33"><a href="#cb127-33" aria-hidden="true" tabindex="-1"></a>      t.maxes[i] <span class="ot">&lt;-</span> <span class="fu">max</span>(simA)<span class="sc">-</span><span class="fu">max</span>(simB)</span>
<span id="cb127-34"><a href="#cb127-34" aria-hidden="true" tabindex="-1"></a>      t.kss[i] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">ks.test</span>(simA,simB)[<span class="dv">1</span>])</span>
<span id="cb127-35"><a href="#cb127-35" aria-hidden="true" tabindex="-1"></a>    }    </span>
<span id="cb127-36"><a href="#cb127-36" aria-hidden="true" tabindex="-1"></a>    rej.mean[j] <span class="ot">&lt;-</span> <span class="fu">mean</span>(t.means <span class="sc">&gt;=</span> obs.mean) <span class="sc">&lt;=</span><span class="fl">0.05</span></span>
<span id="cb127-37"><a href="#cb127-37" aria-hidden="true" tabindex="-1"></a>    rej.median[j] <span class="ot">&lt;-</span> <span class="fu">mean</span>(t.medians <span class="sc">&gt;=</span> obs.median) <span class="sc">&lt;=</span><span class="fl">0.05</span></span>
<span id="cb127-38"><a href="#cb127-38" aria-hidden="true" tabindex="-1"></a>    rej.max[j] <span class="ot">&lt;-</span> <span class="fu">mean</span>(t.maxes <span class="sc">&gt;=</span> obs.max) <span class="sc">&lt;=</span><span class="fl">0.05</span></span>
<span id="cb127-39"><a href="#cb127-39" aria-hidden="true" tabindex="-1"></a>    rej.ks[j] <span class="ot">&lt;-</span> <span class="fu">mean</span>(t.kss <span class="sc">&gt;=</span> obs.ks) <span class="sc">&lt;=</span><span class="fl">0.05</span></span>
<span id="cb127-40"><a href="#cb127-40" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb127-41"><a href="#cb127-41" aria-hidden="true" tabindex="-1"></a>  rr.mean[k] <span class="ot">&lt;-</span> <span class="fu">mean</span>(rej.mean)</span>
<span id="cb127-42"><a href="#cb127-42" aria-hidden="true" tabindex="-1"></a>  rr.max[k] <span class="ot">&lt;-</span> <span class="fu">mean</span>(rej.max)</span>
<span id="cb127-43"><a href="#cb127-43" aria-hidden="true" tabindex="-1"></a>  rr.median[k] <span class="ot">&lt;-</span> <span class="fu">mean</span>(rej.median)</span>
<span id="cb127-44"><a href="#cb127-44" aria-hidden="true" tabindex="-1"></a>  rr.ks[k] <span class="ot">&lt;-</span> <span class="fu">mean</span>(rej.ks)</span>
<span id="cb127-45"><a href="#cb127-45" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb127-46"><a href="#cb127-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-47"><a href="#cb127-47" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x=</span>effects, <span class="at">y=</span>rr.mean, <span class="at">type=</span><span class="st">"l"</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">main=</span><span class="st">"Rejection rate of different test statistics"</span>, <span class="at">xlab=</span><span class="st">"effect size"</span>, <span class="at">ylab=</span><span class="st">"rejection rate"</span>)</span>
<span id="cb127-48"><a href="#cb127-48" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x=</span>effects, <span class="at">y=</span>rr.max, <span class="at">col=</span><span class="st">"red"</span>)</span>
<span id="cb127-49"><a href="#cb127-49" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x=</span>effects, <span class="at">y=</span>rr.median, <span class="at">col=</span><span class="st">"blue"</span>)</span>
<span id="cb127-50"><a href="#cb127-50" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x=</span>effects, <span class="at">y=</span>rr.ks, <span class="at">col=</span><span class="st">"darkgreen"</span>)</span>
<span id="cb127-51"><a href="#cb127-51" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span>.<span class="dv">05</span>)</span>
<span id="cb127-52"><a href="#cb127-52" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="at">x=</span><span class="dv">0</span>, <span class="at">y=</span><span class="dv">1</span>, <span class="at">legend=</span><span class="fu">c</span>(<span class="st">"means"</span>,<span class="st">"medians"</span>,<span class="st">"deviance"</span>,<span class="st">"max"</span>), <span class="at">col=</span><span class="fu">c</span>(<span class="st">"black"</span>,<span class="st">"blue"</span>,<span class="st">"darkgreen"</span>,<span class="st">"red"</span>), <span class="at">lty=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="R05_testing_Additional_Examples_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="random-number-string" class="level2" data-number="16.7">
<h2 data-number="16.7" class="anchored" data-anchor-id="random-number-string"><span class="header-section-number">16.7</span> Random number string</h2>
<p>I want is the numbers 1 through 20 shuffled up. I ask both a computer and a person to provide me with this number string. Suppose I get the string, but I don’t know whether it came from the computer or the person.</p>
<p>from 2/20/2025 afternoon lecture 4 7 5 18 11 12 14 2 3 17 10 1 9 16 20 8 13 19 6 15</p>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-50_d2aa2d8c16f8a1380bfe28728dcd3630">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>obs.Seq <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">7</span>,<span class="dv">5</span>,<span class="dv">18</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">14</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">17</span>,<span class="dv">10</span>,<span class="dv">1</span>,<span class="dv">9</span>,<span class="dv">16</span>,<span class="dv">20</span>,<span class="dv">8</span>,<span class="dv">13</span>,<span class="dv">19</span>,<span class="dv">6</span>,<span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><span class="math inline">\(H_0:\)</span> data generated truly randomly <span class="math inline">\(H_A:\)</span> data generated by humans, not randomly, but attempted</p>
<p>Let’s use The number of values that are not in their original place</p>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-51_3ff438fa28b2f99fe9b40d7185da65db">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>count_moved <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(x)</span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>((<span class="dv">1</span><span class="sc">:</span>n) <span class="sc">==</span> x)</span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a>t.sim <span class="ot">&lt;-</span> <span class="fu">replicate</span>(<span class="dv">10000</span>, <span class="fu">count_moved</span>(<span class="fu">sample</span>(<span class="dv">20</span>)))</span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(t.sim)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="R05_testing_Additional_Examples_files/figure-html/unnamed-chunk-51-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(t.sim <span class="sc">&gt;=</span> <span class="fu">count_moved</span>(obs.Seq))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
</div>
<p>19, 7, 5, 4, 13, 11, 2, 12, 3, 1, 15, 10, 18, 16, 9, 17, 20, 14, 6, 8</p>
<p>(generated 9/26: 1 6 18 12 15 19 20 5 2 17 11 3 9 16 4 7 8 10 13 14)</p>
<p>How can I use a permutation test to determine the likely source of this string of numbers???? Said more precisely, is there evidence that sequence came from a human (not a true randomizer). The idea here is that humans are actually not great at mentally randomizing. We put patterns into things subconsciously.</p>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-52_2dd288e165f232f0e455dbe2b1af4cb7">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>numbers.obs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">19</span>, <span class="dv">7</span>, <span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">13</span>, <span class="dv">11</span>, <span class="dv">2</span>, <span class="dv">12</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">15</span>, <span class="dv">10</span>, <span class="dv">18</span>, <span class="dv">16</span>, <span class="dv">9</span>, <span class="dv">17</span>, <span class="dv">20</span>, <span class="dv">14</span>, <span class="dv">6</span>, <span class="dv">8</span>)</span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a><span class="co">#We need a way to generate a random shuffling of the numbers</span></span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a>generate_numbers <span class="ot">&lt;-</span> <span class="cf">function</span>(n.numbers){</span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">sample</span>(n.numbers))</span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We also need some statistic or measurement of our data which indicates the weirdness of it. Let’s think about what wouldn’t be random.</p>
<p>1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20</p>
<p>An increasing sequence of integers is very much not random. We can quantify this by counting how many differences are positive. In a random shuffling we would have some decreases and some increases. So let’s start with that statistic: The number of positive differences.</p>
<section id="mean-absolute-deviation" class="level3" data-number="16.7.1">
<h3 data-number="16.7.1" class="anchored" data-anchor-id="mean-absolute-deviation"><span class="header-section-number">16.7.1</span> Mean Absolute deviation</h3>
<p>We can look at the distance of each digit from where it “started” from. Rather than just averaging all of their deviations (which would have positive deviations cancelling out with negative deviations) we can look at absolute deviations (absolute values).</p>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-53_9beac096be7efdef203d45e22f6ae35e">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>mean_abs_dev <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(x)</span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span> (<span class="fu">mean</span>(<span class="fu">abs</span>(x <span class="sc">-</span> <span class="dv">1</span><span class="sc">:</span>n)))</span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a>t.obs <span class="ot">&lt;-</span> <span class="fu">mean_abs_dev</span>(obs.Seq)</span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-8"><a href="#cb133-8" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb133-9"><a href="#cb133-9" aria-hidden="true" tabindex="-1"></a>mean.abs.dev.sim <span class="ot">&lt;-</span> <span class="fu">replicate</span>(<span class="dv">10000</span>, <span class="fu">mean_abs_dev</span>(<span class="fu">generate_numbers</span>(<span class="dv">20</span>)))</span>
<span id="cb133-10"><a href="#cb133-10" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(mean.abs.dev.sim)</span>
<span id="cb133-11"><a href="#cb133-11" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span>t.obs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="R05_testing_Additional_Examples_files/figure-html/unnamed-chunk-53-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="co">#2 tail p-value</span></span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="sc">*</span> <span class="fu">min</span>(<span class="fu">mean</span>(mean.abs.dev.sim <span class="sc">&lt;=</span> t.obs), <span class="fu">mean</span>(mean.abs.dev.sim <span class="sc">&gt;=</span> t.obs))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.4122</code></pre>
</div>
</div>
<p>A two-tailed <span class="math inline">\(p\)</span>-value of .354 is unconvincing; we have no evidence that this sequence of numbers wasn’t truly “randomly generated.”</p>
</section>
<section id="number-of-positive-differences" class="level3" data-number="16.7.2">
<h3 data-number="16.7.2" class="anchored" data-anchor-id="number-of-positive-differences"><span class="header-section-number">16.7.2</span> Number of positive differences</h3>
<p>In an ordered sequence the difference between every pair of consecitive digits is +1 or -1. We could count how many (out of n-1) of the differences are positive. If the number of positive differences is too high OR too low we would suspect non-randomness; this is a two-tailed test.</p>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-54_f6a43bdb64223b59d4987703fa1c6e56">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>count_pos_diff <span class="ot">&lt;-</span> <span class="cf">function</span>(numbers){</span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">return</span>(<span class="fu">sum</span>(<span class="fu">diff</span>(numbers)<span class="sc">&gt;</span><span class="dv">0</span> ))</span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a><span class="fu">count_pos_diff</span>(numbers.obs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7</code></pre>
</div>
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>NMC <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a>t.posdiff <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>NMC){</span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a>  t.posdiff[i] <span class="ot">&lt;-</span> <span class="fu">count_pos_diff</span>(<span class="fu">generate_numbers</span>(<span class="dv">20</span>))</span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb138-7"><a href="#cb138-7" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(t.posdiff)</span>
<span id="cb138-8"><a href="#cb138-8" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">count_pos_diff</span>(numbers.obs))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="R05_testing_Additional_Examples_files/figure-html/unnamed-chunk-54-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>(p.val <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">*</span><span class="fu">min</span>(</span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(t.posdiff <span class="sc">&lt;=</span> <span class="fu">count_pos_diff</span>(numbers.obs)),</span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(t.posdiff <span class="sc">&gt;=</span> <span class="fu">count_pos_diff</span>(numbers.obs))</span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1278</code></pre>
</div>
</div>
<p>Drawback of this distribution we see is that it is discrete. I’m not a big fan of discrete distributions because they can be sensitive to just a single data value, and the p-value you get increases in big jumps as you move through the distribution.</p>
<p>If looking only at number of positive differences we don’t see an unusually large (or unusually small) number of positive difference. No evidence of randomness. However look at this dataset:</p>
<p>1, 3, 2, 5, 4, 7, 6, 9, 8, 11, 10, 13, 12, 15, 14, 17, 16, 19, 18, 20</p>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-55_7db82f57c2df595adf900845f5672625">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="fu">count_pos_diff</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">6</span>, <span class="dv">9</span>, <span class="dv">8</span>, <span class="dv">11</span>, <span class="dv">10</span>, <span class="dv">13</span>, <span class="dv">12</span>, <span class="dv">15</span>, <span class="dv">14</span>, <span class="dv">17</span>, <span class="dv">16</span>, <span class="dv">19</span>, <span class="dv">18</span>, <span class="dv">20</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 10</code></pre>
</div>
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">6</span>, <span class="dv">9</span>, <span class="dv">8</span>, <span class="dv">11</span>, <span class="dv">10</span>, <span class="dv">13</span>, <span class="dv">12</span>, <span class="dv">15</span>, <span class="dv">14</span>, <span class="dv">17</span>, <span class="dv">16</span>, <span class="dv">19</span>, <span class="dv">18</span>, <span class="dv">20</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="R05_testing_Additional_Examples_files/figure-html/unnamed-chunk-55-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>It’s very close to the middle of the distribution, but it’s a clear pattern. So the SIZE of the differences is clearly meaningful. We would want the differences to have the right amount of variation. If we take the differences of each consecutive pair of numbers, we can look at the <em>standard deviation</em> of those differences. That might be a good statistic to use.</p>
</section>
<section id="standard-deviation-of-differences" class="level3" data-number="16.7.3">
<h3 data-number="16.7.3" class="anchored" data-anchor-id="standard-deviation-of-differences"><span class="header-section-number">16.7.3</span> Standard Deviation of Differences</h3>
<p>Again note that this is a two-tailed test, because if the variation is too high or too low that would be evidence of non-randomness.</p>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-56_440c1cbbe2836b523adbca42e9b8a06a">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>calc_sd_diff <span class="ot">&lt;-</span> <span class="cf">function</span>(numbers){</span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">return</span>(<span class="fu">sd</span>(<span class="fu">diff</span>(numbers) ))</span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a>NMC <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb144-6"><a href="#cb144-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb144-7"><a href="#cb144-7" aria-hidden="true" tabindex="-1"></a>t.sddiff <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb144-8"><a href="#cb144-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>NMC){</span>
<span id="cb144-9"><a href="#cb144-9" aria-hidden="true" tabindex="-1"></a>  t.sddiff[i] <span class="ot">&lt;-</span> <span class="fu">calc_sd_diff</span>(<span class="fu">generate_numbers</span>(<span class="dv">20</span>))</span>
<span id="cb144-10"><a href="#cb144-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb144-11"><a href="#cb144-11" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(t.sddiff)</span>
<span id="cb144-12"><a href="#cb144-12" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">calc_sd_diff</span>(numbers.obs))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="R05_testing_Additional_Examples_files/figure-html/unnamed-chunk-56-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="sc">*</span><span class="fu">min</span>(<span class="fu">mean</span>(t.sddiff <span class="sc">&lt;=</span> <span class="fu">calc_sd_diff</span>(numbers.obs)),</span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mean</span>(t.sddiff <span class="sc">&gt;=</span> <span class="fu">calc_sd_diff</span>(numbers.obs)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2702</code></pre>
</div>
</div>
</section>
<section id="mean-absolute-difference" class="level3" data-number="16.7.4">
<h3 data-number="16.7.4" class="anchored" data-anchor-id="mean-absolute-difference"><span class="header-section-number">16.7.4</span> Mean absolute difference</h3>
<p>Another statistic we could look at is related to the <em>absolute values</em> of the differences - the average absolute difference. Again- this is a two-tailed test. Too high or too low would be evidence of nonrandomness.</p>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-57_abd19bd097d1add4be9af8c17c61b0d1">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>calc_mean_abs_diff <span class="ot">&lt;-</span> <span class="cf">function</span>(numbers){</span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">return</span>(<span class="fu">mean</span>(<span class="fu">abs</span>(<span class="fu">diff</span>(numbers))))</span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-5"><a href="#cb147-5" aria-hidden="true" tabindex="-1"></a>NMC <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb147-6"><a href="#cb147-6" aria-hidden="true" tabindex="-1"></a>t.meanabsdiff <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb147-7"><a href="#cb147-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>NMC){</span>
<span id="cb147-8"><a href="#cb147-8" aria-hidden="true" tabindex="-1"></a>  t.meanabsdiff[i] <span class="ot">&lt;-</span> <span class="fu">calc_mean_abs_diff</span>(<span class="fu">generate_numbers</span>(<span class="dv">20</span>))</span>
<span id="cb147-9"><a href="#cb147-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb147-10"><a href="#cb147-10" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(t.meanabsdiff, <span class="at">breaks =</span> <span class="dv">50</span>)</span>
<span id="cb147-11"><a href="#cb147-11" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">calc_mean_abs_diff</span>(numbers.obs))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="R05_testing_Additional_Examples_files/figure-html/unnamed-chunk-57-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="sc">*</span><span class="fu">min</span>(<span class="fu">mean</span>(t.meanabsdiff <span class="sc">&lt;=</span> <span class="fu">calc_mean_abs_diff</span>(obs.Seq)),</span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mean</span>(t.meanabsdiff <span class="sc">&gt;=</span> <span class="fu">calc_mean_abs_diff</span>(obs.Seq)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9274</code></pre>
</div>
</div>
<p>No evidence of nonrandomness! We could be pretty satisfied that the string of integers was properly shuffled by a computer.</p>
<p>What about this one?</p>
<p>2 9 3 13 18 4 17 10 1 15 7 5 12 20 6 19 8 16 14 11</p>
<p>Do you think this was generated by computer or by human?</p>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-58_a18a3ca1679475348bce910c15876074">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>new.obs.data<span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">9</span>,<span class="dv">3</span>,<span class="dv">13</span>,<span class="dv">18</span>,<span class="dv">4</span>,<span class="dv">17</span>,<span class="dv">10</span>,<span class="dv">1</span>,<span class="dv">15</span>,<span class="dv">7</span>,<span class="dv">5</span>,<span class="dv">12</span>,<span class="dv">20</span>,<span class="dv">6</span>,<span class="dv">19</span>,<span class="dv">8</span>,<span class="dv">16</span>,<span class="dv">14</span>,<span class="dv">11</span>)</span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Mean absolute deviation</span></span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="sc">*</span><span class="fu">min</span>(<span class="fu">mean</span>(mean.abs.dev.sim <span class="sc">&gt;=</span> <span class="fu">mean_abs_dev</span>(new.obs.data)),</span>
<span id="cb150-5"><a href="#cb150-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean</span>(mean.abs.dev.sim <span class="sc">&lt;=</span> <span class="fu">mean_abs_dev</span>(new.obs.data))) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.3034</code></pre>
</div>
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Positive Differences</span></span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="sc">*</span><span class="fu">min</span>(<span class="fu">mean</span>(t.posdiff <span class="sc">&gt;=</span> <span class="fu">count_pos_diff</span>(new.obs.data)),</span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean</span>(t.posdiff <span class="sc">&lt;=</span> <span class="fu">count_pos_diff</span>(new.obs.data))) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9904</code></pre>
</div>
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="co">#SD Differences</span></span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="sc">*</span><span class="fu">min</span>(<span class="fu">mean</span>(t.sddiff <span class="sc">&gt;=</span> <span class="fu">calc_sd_diff</span>(new.obs.data)),</span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean</span>(t.sddiff <span class="sc">&lt;=</span> <span class="fu">calc_sd_diff</span>(new.obs.data))) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2834</code></pre>
</div>
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Mean Abs Differences</span></span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="sc">*</span><span class="fu">min</span>(<span class="fu">mean</span>(t.meanabsdiff <span class="sc">&gt;=</span> <span class="fu">calc_mean_abs_diff</span>(new.obs.data)),</span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean</span>(t.meanabsdiff <span class="sc">&lt;=</span> <span class="fu">calc_mean_abs_diff</span>(new.obs.data))) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.104</code></pre>
</div>
</div>
</section>
<section id="comparing-the-test-statistics" class="level3" data-number="16.7.5">
<h3 data-number="16.7.5" class="anchored" data-anchor-id="comparing-the-test-statistics"><span class="header-section-number">16.7.5</span> Comparing The Test Statistics</h3>
<p>I want to compare the power of the test statistics as the randomness of an array increases. In order to do this we would have to have a sense of an “effect size” and look at rejection rates as effect size increases - as the vector gets more and more shuffled.</p>
<p>A function that randomly chooses one value in an array and moves it to the first index can be used to incrementaly shuffle an array, so we can have some that are very unrandom, and very random. There are other ways to create gradually more “randomized” lists, but this is the one I’ll use.</p>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-59_2fccfdda34e77fc76903a8a80b89a5f3">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a>popOnce <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#pops a random element to the top of the list</span></span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a>  ridx <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">length</span>(x),<span class="dv">1</span>)</span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">c</span>(x[<span class="sc">-</span>ridx],x[ridx]))</span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then the <code>shuffleN</code> function takes the numbers in a vector <code>x</code> and calls the <code>popOnce</code> function <code>n</code> times.</p>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-60_cdc585d31f5e699c0e959ac1a8bbc201">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>shuffleN <span class="ot">&lt;-</span> <span class="cf">function</span>(x,<span class="at">n=</span><span class="dv">1</span>){</span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n){</span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> <span class="fu">popOnce</span>(x)</span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb159-5"><a href="#cb159-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(x)</span>
<span id="cb159-6"><a href="#cb159-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb159-7"><a href="#cb159-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-8"><a href="#cb159-8" aria-hidden="true" tabindex="-1"></a>maxPops <span class="ot">&lt;-</span> <span class="dv">40</span></span>
<span id="cb159-9"><a href="#cb159-9" aria-hidden="true" tabindex="-1"></a>pops <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>maxPops</span>
<span id="cb159-10"><a href="#cb159-10" aria-hidden="true" tabindex="-1"></a>rr.madev <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, maxPops)</span>
<span id="cb159-11"><a href="#cb159-11" aria-hidden="true" tabindex="-1"></a>rr.pd <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>,maxPops)</span>
<span id="cb159-12"><a href="#cb159-12" aria-hidden="true" tabindex="-1"></a>rr.sdd <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>,maxPops)</span>
<span id="cb159-13"><a href="#cb159-13" aria-hidden="true" tabindex="-1"></a>rr.mad <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>,maxPops)</span>
<span id="cb159-14"><a href="#cb159-14" aria-hidden="true" tabindex="-1"></a>NMC <span class="ot">&lt;-</span> <span class="dv">5000</span></span>
<span id="cb159-15"><a href="#cb159-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-16"><a href="#cb159-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(k <span class="cf">in</span> pops){</span>
<span id="cb159-17"><a href="#cb159-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>NMC){</span>
<span id="cb159-18"><a href="#cb159-18" aria-hidden="true" tabindex="-1"></a>     shuffledData <span class="ot">&lt;-</span> <span class="fu">shuffleN</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>,k)</span>
<span id="cb159-19"><a href="#cb159-19" aria-hidden="true" tabindex="-1"></a>        <span class="co">#Absolute Deviation</span></span>
<span id="cb159-20"><a href="#cb159-20" aria-hidden="true" tabindex="-1"></a>        rr.madev[k] <span class="ot">&lt;-</span> rr.madev[k] <span class="sc">+</span> (<span class="dv">2</span><span class="sc">*</span><span class="fu">min</span>(<span class="fu">mean</span>(mean.abs.dev.sim <span class="sc">&gt;=</span> <span class="fu">mean_abs_dev</span>(shuffledData)),</span>
<span id="cb159-21"><a href="#cb159-21" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mean</span>(mean.abs.dev.sim <span class="sc">&lt;=</span> <span class="fu">mean_abs_dev</span>(shuffledData))) <span class="sc">&lt;=</span><span class="fl">0.05</span> )</span>
<span id="cb159-22"><a href="#cb159-22" aria-hidden="true" tabindex="-1"></a>        <span class="co">#Positive Differences</span></span>
<span id="cb159-23"><a href="#cb159-23" aria-hidden="true" tabindex="-1"></a>        rr.pd[k] <span class="ot">&lt;-</span> rr.pd[k] <span class="sc">+</span> (<span class="dv">2</span><span class="sc">*</span><span class="fu">min</span>(<span class="fu">mean</span>(t.posdiff <span class="sc">&gt;=</span> <span class="fu">count_pos_diff</span>(shuffledData)),</span>
<span id="cb159-24"><a href="#cb159-24" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mean</span>(t.posdiff <span class="sc">&lt;=</span> <span class="fu">count_pos_diff</span>(shuffledData))) <span class="sc">&lt;=</span><span class="fl">0.05</span> )</span>
<span id="cb159-25"><a href="#cb159-25" aria-hidden="true" tabindex="-1"></a>        <span class="co">#SD Differences</span></span>
<span id="cb159-26"><a href="#cb159-26" aria-hidden="true" tabindex="-1"></a>        rr.sdd[k] <span class="ot">&lt;-</span> rr.sdd[k] <span class="sc">+</span> (<span class="dv">2</span><span class="sc">*</span><span class="fu">min</span>(<span class="fu">mean</span>(t.sddiff <span class="sc">&gt;=</span> <span class="fu">calc_sd_diff</span>(shuffledData)),</span>
<span id="cb159-27"><a href="#cb159-27" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mean</span>(t.sddiff <span class="sc">&lt;=</span> <span class="fu">calc_sd_diff</span>(shuffledData))) <span class="sc">&lt;=</span> <span class="fl">0.05</span>)</span>
<span id="cb159-28"><a href="#cb159-28" aria-hidden="true" tabindex="-1"></a>        <span class="co">#Mean Abs Differences</span></span>
<span id="cb159-29"><a href="#cb159-29" aria-hidden="true" tabindex="-1"></a>        rr.mad[k] <span class="ot">&lt;-</span> rr.mad[k] <span class="sc">+</span> (<span class="dv">2</span><span class="sc">*</span><span class="fu">min</span>(<span class="fu">mean</span>(t.meanabsdiff <span class="sc">&gt;=</span> <span class="fu">calc_mean_abs_diff</span>(shuffledData)),</span>
<span id="cb159-30"><a href="#cb159-30" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mean</span>(t.meanabsdiff <span class="sc">&lt;=</span> <span class="fu">calc_mean_abs_diff</span>(shuffledData))) <span class="sc">&lt;=</span><span class="fl">0.05</span>) </span>
<span id="cb159-31"><a href="#cb159-31" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb159-32"><a href="#cb159-32" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb159-33"><a href="#cb159-33" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pops, rr.pd<span class="sc">/</span>NMC, <span class="at">type=</span><span class="st">"l"</span>, <span class="at">col=</span><span class="st">"darkgreen"</span>)</span>
<span id="cb159-34"><a href="#cb159-34" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(pops, rr.sdd<span class="sc">/</span>NMC, <span class="at">col=</span><span class="st">"blue"</span>)</span>
<span id="cb159-35"><a href="#cb159-35" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(pops, rr.mad<span class="sc">/</span>NMC, <span class="at">col=</span><span class="st">"red"</span>)</span>
<span id="cb159-36"><a href="#cb159-36" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(pops, rr.madev<span class="sc">/</span>NMC, <span class="at">col=</span><span class="st">"orange"</span>)</span>
<span id="cb159-37"><a href="#cb159-37" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="at">col=</span><span class="fu">c</span>(<span class="st">"darkgreen"</span>,<span class="st">"blue"</span>,<span class="st">"red"</span>, <span class="st">"orange"</span>), <span class="at">x=</span>maxPops<span class="sc">*</span>.<span class="dv">65</span>, <span class="at">y=</span><span class="dv">1</span>, <span class="at">legend=</span><span class="fu">c</span>(<span class="st">"#posDiff"</span>,<span class="st">"sdDiff"</span>,<span class="st">"meanAbsDiff"</span>, <span class="st">"meanAbsDev"</span>), <span class="at">lty=</span><span class="dv">1</span>)</span>
<span id="cb159-38"><a href="#cb159-38" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="fl">0.05</span>, <span class="at">lty=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="R05_testing_Additional_Examples_files/figure-html/unnamed-chunk-60-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>From this plot it seems that the number of positive differences in the sequence is the most powerful test statistic to detect a non-randomized list. BUt of course, this is only if “non-randomized” is measured in the way we’ve defined in terms of the “effect size”.</p>
</section>
</section>
<section id="random-visual-noise-detection" class="level2" data-number="16.8">
<h2 data-number="16.8" class="anchored" data-anchor-id="random-visual-noise-detection"><span class="header-section-number">16.8</span> Random Visual Noise detection</h2>
<p>Suppose we see an image on a monitor and want to determine if it is just random noise or if there is a pattern. Maybe this is data from a transmission from deep space. Is it just random noise, or is it possibly a message from an intelligent alien species?</p>
<p>For simplicity let’s say it is black/white pixels in a 16x16 grid:</p>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-61_a6d5a39159ba549b40c400f7ef220d18">
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a>obsData <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a>           <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,</span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a>             <span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,</span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a>             <span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,</span>
<span id="cb160-5"><a href="#cb160-5" aria-hidden="true" tabindex="-1"></a>             <span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,</span>
<span id="cb160-6"><a href="#cb160-6" aria-hidden="true" tabindex="-1"></a>             <span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,</span>
<span id="cb160-7"><a href="#cb160-7" aria-hidden="true" tabindex="-1"></a>             <span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,</span>
<span id="cb160-8"><a href="#cb160-8" aria-hidden="true" tabindex="-1"></a>             <span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,</span>
<span id="cb160-9"><a href="#cb160-9" aria-hidden="true" tabindex="-1"></a>             <span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,</span>
<span id="cb160-10"><a href="#cb160-10" aria-hidden="true" tabindex="-1"></a>             <span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,</span>
<span id="cb160-11"><a href="#cb160-11" aria-hidden="true" tabindex="-1"></a>             <span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,</span>
<span id="cb160-12"><a href="#cb160-12" aria-hidden="true" tabindex="-1"></a>             <span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,</span>
<span id="cb160-13"><a href="#cb160-13" aria-hidden="true" tabindex="-1"></a>             <span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,</span>
<span id="cb160-14"><a href="#cb160-14" aria-hidden="true" tabindex="-1"></a>             <span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,</span>
<span id="cb160-15"><a href="#cb160-15" aria-hidden="true" tabindex="-1"></a>             <span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,</span>
<span id="cb160-16"><a href="#cb160-16" aria-hidden="true" tabindex="-1"></a>             <span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,</span>
<span id="cb160-17"><a href="#cb160-17" aria-hidden="true" tabindex="-1"></a>             <span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb160-18"><a href="#cb160-18" aria-hidden="true" tabindex="-1"></a>           <span class="at">nrow=</span><span class="dv">16</span>,<span class="at">byrow=</span><span class="cn">TRUE</span>)</span>
<span id="cb160-19"><a href="#cb160-19" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">pty=</span><span class="st">"s"</span>)</span>
<span id="cb160-20"><a href="#cb160-20" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(raster)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: raster</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: sp</code></pre>
</div>
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="fu">image</span>(obsData, <span class="at">useRaster=</span><span class="cn">TRUE</span>, <span class="at">axes=</span><span class="cn">FALSE</span>, <span class="at">col=</span><span class="fu">c</span>(<span class="st">"black"</span>,<span class="st">"white"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="R05_testing_Additional_Examples_files/figure-html/unnamed-chunk-61-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We want to devise a hypothesis test that will test for randomness. What can we use? Let’s look at some summary stats.</p>
<section id="test-stat-1-variability-in-number-of-1s-per-region" class="level3" data-number="16.8.1">
<h3 data-number="16.8.1" class="anchored" data-anchor-id="test-stat-1-variability-in-number-of-1s-per-region"><span class="header-section-number">16.8.1</span> Test Stat 1: variability in number of 1s per region</h3>
<p>Idea: Slice it into 4x4 chunks, and count the number of 1s, then calculate the standard deviation. If we have random noise data then we should have some variability in each of these 16 sub-squares.</p>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-62_e87cebbe4cfe043efb4b20aed1399862">
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a>sd_chunk_1s <span class="ot">&lt;-</span> <span class="cf">function</span>(matrix){</span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#I will assume that the data is 16x16. This function is not going to</span></span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#generalize well to other sized inputs.</span></span>
<span id="cb164-4"><a href="#cb164-4" aria-hidden="true" tabindex="-1"></a>  results <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="dv">0</span>)</span>
<span id="cb164-5"><a href="#cb164-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">1</span>,<span class="dv">15</span>, <span class="dv">4</span>)){</span>
<span id="cb164-6"><a href="#cb164-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(j <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">1</span>,<span class="dv">15</span>, <span class="dv">4</span>)){</span>
<span id="cb164-7"><a href="#cb164-7" aria-hidden="true" tabindex="-1"></a>      chunk <span class="ot">&lt;-</span> matrix[i<span class="sc">:</span>(i<span class="sc">+</span><span class="dv">3</span>), j<span class="sc">:</span>(j<span class="sc">+</span><span class="dv">3</span>)]</span>
<span id="cb164-8"><a href="#cb164-8" aria-hidden="true" tabindex="-1"></a>      results <span class="ot">&lt;-</span> <span class="fu">rbind</span>(results, <span class="fu">sum</span>(chunk))</span>
<span id="cb164-9"><a href="#cb164-9" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb164-10"><a href="#cb164-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb164-11"><a href="#cb164-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">sd</span>(results))</span>
<span id="cb164-12"><a href="#cb164-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb164-13"><a href="#cb164-13" aria-hidden="true" tabindex="-1"></a><span class="fu">sd_chunk_1s</span>(obsData)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.181454</code></pre>
</div>
</div>
<p>We can perform our permutation test, randomizing the grid and calculating the test statistic on each run.</p>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-63_94f467b7ca744ba459d7157dda40a960">
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Permutation test</span></span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a>test.stat.sim <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>){</span>
<span id="cb166-4"><a href="#cb166-4" aria-hidden="true" tabindex="-1"></a>  test.stat.sim[i] <span class="ot">&lt;-</span> <span class="fu">sd_chunk_1s</span>(<span class="fu">matrix</span>(<span class="at">data=</span><span class="fu">sample</span>(obsData), <span class="at">nrow=</span><span class="fu">dim</span>(obsData)[<span class="dv">1</span>], <span class="at">byrow=</span><span class="cn">TRUE</span>))</span>
<span id="cb166-5"><a href="#cb166-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb166-6"><a href="#cb166-6" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(test.stat.sim, <span class="at">breaks=</span><span class="dv">25</span>)</span>
<span id="cb166-7"><a href="#cb166-7" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">sd_chunk_1s</span>(obsData))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="R05_testing_Additional_Examples_files/figure-html/unnamed-chunk-63-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="co">#two tailed test, ie if sd too low or too high that is unusual</span></span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="sc">*</span><span class="fu">min</span>(<span class="fu">mean</span>(test.stat.sim <span class="sc">&lt;=</span> <span class="fu">sd_chunk_1s</span>(obsData)), </span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mean</span>(test.stat.sim <span class="sc">&gt;=</span> <span class="fu">sd_chunk_1s</span>(obsData)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.02</code></pre>
</div>
</div>
</section>
<section id="test-stat-2-horizontal-symmetry" class="level3" data-number="16.8.2">
<h3 data-number="16.8.2" class="anchored" data-anchor-id="test-stat-2-horizontal-symmetry"><span class="header-section-number">16.8.2</span> Test Stat 2: Horizontal Symmetry</h3>
<p>We can look at what proportion of pixels are the same as their mirror pixel. A fast way to calculate that is to compare the image with it’s flip, do a conditional comparison of values, and divide by 2.</p>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-64_953347fe7696752968196a1cee68a711">
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a>calculate_horizontal_symmetry <span class="ot">&lt;-</span> <span class="cf">function</span>(matrix){</span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a>  nCols <span class="ot">&lt;-</span> <span class="fu">dim</span>(matrix)[<span class="dv">2</span>]</span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a>  matrix.flip <span class="ot">&lt;-</span> matrix[,nCols<span class="sc">:</span><span class="dv">1</span>]</span>
<span id="cb169-4"><a href="#cb169-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">sum</span>(matrix<span class="sc">==</span>matrix.flip)<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb169-5"><a href="#cb169-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb169-6"><a href="#cb169-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-7"><a href="#cb169-7" aria-hidden="true" tabindex="-1"></a>NMC <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb169-8"><a href="#cb169-8" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb169-9"><a href="#cb169-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>NMC){</span>
<span id="cb169-10"><a href="#cb169-10" aria-hidden="true" tabindex="-1"></a>  shuffledMatrix <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data=</span><span class="fu">sample</span>(obsData), <span class="at">nrow=</span><span class="fu">dim</span>(obsData)[<span class="dv">1</span>], <span class="at">byrow=</span><span class="cn">TRUE</span>)</span>
<span id="cb169-11"><a href="#cb169-11" aria-hidden="true" tabindex="-1"></a>  results[i] <span class="ot">&lt;-</span> <span class="fu">calculate_horizontal_symmetry</span>(shuffledMatrix)</span>
<span id="cb169-12"><a href="#cb169-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb169-13"><a href="#cb169-13" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(results)</span>
<span id="cb169-14"><a href="#cb169-14" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">calculate_horizontal_symmetry</span>(obsData))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="R05_testing_Additional_Examples_files/figure-html/unnamed-chunk-64-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="fu">calculate_horizontal_symmetry</span>(obsData)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 63</code></pre>
</div>
</div>
</section>
<section id="test-stat-3-neighbor-edges" class="level3" data-number="16.8.3">
<h3 data-number="16.8.3" class="anchored" data-anchor-id="test-stat-3-neighbor-edges"><span class="header-section-number">16.8.3</span> Test stat 3: Neighbor edges</h3>
<p>Look at vertical neighbors (and horizontal neighbors)</p>
<p>A 00 edge will sum to 0 A 01 or 10 edge will sum to 1 A 11 edge will sum to 2</p>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-65_b567ff23751faf5f5ea664d165a8756a">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a>vEdges <span class="ot">&lt;-</span> obsData[<span class="sc">-</span><span class="dv">1</span>,]<span class="sc">+</span>obsData[<span class="sc">-</span><span class="dv">16</span>,]</span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a>hEdges <span class="ot">&lt;-</span> obsData[,<span class="sc">-</span><span class="dv">1</span>]<span class="sc">+</span>obsData[,<span class="sc">-</span><span class="dv">16</span>]</span>
<span id="cb172-3"><a href="#cb172-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(vEdges)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>vEdges
  0   1   2 
 46 121  73 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(hEdges)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>hEdges
  0   1   2 
 43 126  71 </code></pre>
</div>
</div>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-66_877a7248d22f05d6720655284dc05de9">
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Add two tables together!</span></span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(vEdges)<span class="sc">+</span><span class="fu">table</span>(hEdges)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>vEdges
  0   1   2 
 89 247 144 </code></pre>
</div>
</div>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-67_72908a43401c8a0f989bf1d45669f89d">
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Let's let the BW edges be the test statistic to see how well it works:</span></span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a>count_bw_edges <span class="ot">&lt;-</span> <span class="cf">function</span>(matrix){</span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a>  dims <span class="ot">&lt;-</span> <span class="fu">dim</span>(matrix)</span>
<span id="cb178-4"><a href="#cb178-4" aria-hidden="true" tabindex="-1"></a>  vEdges <span class="ot">&lt;-</span> matrix[<span class="sc">-</span><span class="dv">1</span>,]<span class="sc">+</span>matrix[<span class="sc">-</span><span class="fu">dim</span>(matrix)[<span class="dv">1</span>],]</span>
<span id="cb178-5"><a href="#cb178-5" aria-hidden="true" tabindex="-1"></a>  hEdges <span class="ot">&lt;-</span> matrix[,<span class="sc">-</span><span class="dv">1</span>]<span class="sc">+</span>matrix[,<span class="sc">-</span><span class="fu">dim</span>(matrix)[<span class="dv">2</span>]]</span>
<span id="cb178-6"><a href="#cb178-6" aria-hidden="true" tabindex="-1"></a>  bwEdges <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>((<span class="fu">table</span>(<span class="fu">factor</span>(vEdges, <span class="at">levels=</span><span class="dv">0</span><span class="sc">:</span><span class="dv">2</span>))<span class="sc">+</span></span>
<span id="cb178-7"><a href="#cb178-7" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">table</span>(<span class="fu">factor</span>(hEdges, <span class="at">levels=</span><span class="dv">0</span><span class="sc">:</span><span class="dv">2</span>)))[<span class="dv">2</span>])</span>
<span id="cb178-8"><a href="#cb178-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(bwEdges)</span>
<span id="cb178-9"><a href="#cb178-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb178-10"><a href="#cb178-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-11"><a href="#cb178-11" aria-hidden="true" tabindex="-1"></a><span class="fu">count_bw_edges</span>(obsData)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 247</code></pre>
</div>
</div>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-68_51e80391818068ff9cb5f3887012dbd4">
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a>NMC <span class="ot">&lt;-</span> <span class="dv">5000</span></span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>NMC){</span>
<span id="cb180-4"><a href="#cb180-4" aria-hidden="true" tabindex="-1"></a>  shuffledMatrix <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data=</span><span class="fu">sample</span>(obsData), <span class="at">nrow=</span><span class="fu">dim</span>(obsData)[<span class="dv">1</span>], <span class="at">byrow=</span><span class="cn">TRUE</span>)</span>
<span id="cb180-5"><a href="#cb180-5" aria-hidden="true" tabindex="-1"></a>  results[i] <span class="ot">&lt;-</span> <span class="fu">count_bw_edges</span>(shuffledMatrix)</span>
<span id="cb180-6"><a href="#cb180-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb180-7"><a href="#cb180-7" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(results)</span>
<span id="cb180-8"><a href="#cb180-8" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">count_bw_edges</span>(obsData))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="R05_testing_Additional_Examples_files/figure-html/unnamed-chunk-68-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This test statistic doesn’t detect all kinds of non-randomness. Let’s see how well this test statistic does against some image that is definitely not random:</p>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-69_550fb6617a733e194c901f790c225544">
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a>obsData2 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="dv">8</span><span class="sc">*</span><span class="dv">16</span>),<span class="at">nrow=</span><span class="dv">16</span>, <span class="at">byrow=</span><span class="cn">TRUE</span>)</span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a><span class="fu">image</span>(obsData2, <span class="at">useRaster=</span><span class="cn">TRUE</span>, <span class="at">axes=</span><span class="cn">FALSE</span>, <span class="at">col=</span><span class="fu">c</span>(<span class="st">"black"</span>,<span class="st">"white"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="R05_testing_Additional_Examples_files/figure-html/unnamed-chunk-69-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">pty=</span><span class="st">"s"</span>)</span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a><span class="fu">count_bw_edges</span>(obsData2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 240</code></pre>
</div>
</div>
<p>Or this one</p>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-70_cbc3bda7be628c76c14493aef0fea221">
<div class="sourceCode cell-code" id="cb184"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a>obsData3 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>),<span class="dv">8</span>),<span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>),<span class="dv">8</span>)),<span class="dv">4</span>), <span class="at">ncol=</span><span class="dv">16</span>, <span class="at">byrow=</span><span class="cn">TRUE</span>)</span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">pty=</span><span class="st">"s"</span>)</span>
<span id="cb184-3"><a href="#cb184-3" aria-hidden="true" tabindex="-1"></a><span class="fu">image</span>(obsData3, <span class="at">useRaster=</span><span class="cn">TRUE</span>, <span class="at">axes=</span><span class="cn">FALSE</span>, <span class="at">col=</span><span class="fu">c</span>(<span class="st">"black"</span>,<span class="st">"white"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="R05_testing_Additional_Examples_files/figure-html/unnamed-chunk-70-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="fu">count_bw_edges</span>(obsData3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 224</code></pre>
</div>
</div>
<p>Let’s just create a function to automate the MC simulation</p>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-71_7d0aa1c196cbd419344cb685ebbd5912">
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a>generateMCsim <span class="ot">&lt;-</span> <span class="cf">function</span>(data, NMC){</span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a>  results <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb187-3"><a href="#cb187-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>NMC){</span>
<span id="cb187-4"><a href="#cb187-4" aria-hidden="true" tabindex="-1"></a>    shuffledMatrix <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data=</span><span class="fu">sample</span>(data), <span class="at">nrow=</span><span class="fu">dim</span>(data)[<span class="dv">1</span>], <span class="at">byrow=</span><span class="cn">TRUE</span>)</span>
<span id="cb187-5"><a href="#cb187-5" aria-hidden="true" tabindex="-1"></a>    results[i] <span class="ot">&lt;-</span> <span class="fu">count_bw_edges</span>(shuffledMatrix)</span>
<span id="cb187-6"><a href="#cb187-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb187-7"><a href="#cb187-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(results)  </span>
<span id="cb187-8"><a href="#cb187-8" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And now the Monte Carlo part.</p>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-72_f30e4e5bfdf793a3157bcb0cf9bbaa52">
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a>mcDist <span class="ot">&lt;-</span> <span class="fu">generateMCsim</span>(obsData2,<span class="dv">5000</span>)</span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(mcDist)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="R05_testing_Additional_Examples_files/figure-html/unnamed-chunk-72-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="fu">count_bw_edges</span>(obsData2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 240</code></pre>
</div>
</div>
</section>
<section id="test-stat-4-morans-i" class="level3" data-number="16.8.4">
<h3 data-number="16.8.4" class="anchored" data-anchor-id="test-stat-4-morans-i"><span class="header-section-number">16.8.4</span> Test Stat 4: Moran’s I</h3>
<p>We define neighbors to be cardinally adjacent. Moran’s index is a statistic that measures how correlated neighboring cells are</p>
<p><span class="math display">\[I = \frac{N}{W} \frac{\sum_{i=1}^N \sum_{j=1}^N w_{ij}(x_i-\bar{x})(x_j-\bar{x})}{\sum_{i=1}^N(x_i-\bar{x}^2)}\]</span></p>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-73_89ec00d438be92e73e59f07a680e52af">
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a>moranI <span class="ot">&lt;-</span> <span class="cf">function</span>(matrix){</span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a>  N <span class="ot">&lt;-</span> <span class="fu">prod</span>(<span class="fu">dim</span>(matrix))</span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#The number of adjacencies is the product of the dimensions -1</span></span>
<span id="cb191-4"><a href="#cb191-4" aria-hidden="true" tabindex="-1"></a>  W <span class="ot">&lt;-</span> <span class="fu">prod</span>(<span class="fu">dim</span>(matrix)<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb191-5"><a href="#cb191-5" aria-hidden="true" tabindex="-1"></a>  xbar <span class="ot">&lt;-</span> <span class="fu">mean</span>(matrix)</span>
<span id="cb191-6"><a href="#cb191-6" aria-hidden="true" tabindex="-1"></a>  nRow <span class="ot">&lt;-</span> <span class="fu">dim</span>(matrix)[<span class="dv">1</span>]</span>
<span id="cb191-7"><a href="#cb191-7" aria-hidden="true" tabindex="-1"></a>  nCol <span class="ot">&lt;-</span> <span class="fu">dim</span>(matrix)[<span class="dv">2</span>]</span>
<span id="cb191-8"><a href="#cb191-8" aria-hidden="true" tabindex="-1"></a>  I <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">*</span>(<span class="fu">sum</span>((matrix<span class="sc">-</span>xbar)[<span class="sc">-</span><span class="dv">1</span>,]<span class="sc">*</span>(matrix<span class="sc">-</span>xbar)[<span class="sc">-</span>nRow,]) <span class="sc">+</span></span>
<span id="cb191-9"><a href="#cb191-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>((matrix<span class="sc">-</span>xbar)[,<span class="sc">-</span><span class="dv">1</span>]<span class="sc">*</span>(matrix<span class="sc">-</span>xbar)[,<span class="sc">-</span>nCol]) )<span class="sc">/</span></span>
<span id="cb191-10"><a href="#cb191-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>((matrix<span class="sc">-</span>xbar)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">*</span> N<span class="sc">/</span>W</span>
<span id="cb191-11"><a href="#cb191-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(I)</span>
<span id="cb191-12"><a href="#cb191-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb191-13"><a href="#cb191-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-14"><a href="#cb191-14" aria-hidden="true" tabindex="-1"></a>t.sim <span class="ot">&lt;-</span> <span class="fu">replicate</span>(NMC, <span class="fu">moranI</span>(<span class="fu">matrix</span>(<span class="at">data=</span><span class="fu">sample</span>(obsData), <span class="at">nrow=</span><span class="fu">dim</span>(obsData)[<span class="dv">1</span>], <span class="at">byrow=</span><span class="cn">TRUE</span>)))</span>
<span id="cb191-15"><a href="#cb191-15" aria-hidden="true" tabindex="-1"></a>t.obs <span class="ot">&lt;-</span> <span class="fu">moranI</span>(obsData2)</span>
<span id="cb191-16"><a href="#cb191-16" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(t.sim); <span class="fu">abline</span>(<span class="at">v=</span>t.obs, <span class="at">col=</span><span class="st">"red"</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="R05_testing_Additional_Examples_files/figure-html/unnamed-chunk-73-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb192"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="sc">*</span><span class="fu">min</span>( <span class="fu">mean</span>(t.sim<span class="sc">&gt;=</span>t.obs), <span class="fu">mean</span>(t.sim<span class="sc">&lt;=</span>t.obs))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9392</code></pre>
</div>
</div>
</section>
<section id="test-statistic-5-number-of-clumps" class="level3" data-number="16.8.5">
<h3 data-number="16.8.5" class="anchored" data-anchor-id="test-statistic-5-number-of-clumps"><span class="header-section-number">16.8.5</span> Test Statistic 5: Number of clumps</h3>
<p>Let’s count the number of contiguous clumps</p>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-74_2201ca60b8e881f9287f6cfad504558c">
<div class="sourceCode cell-code" id="cb194"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(igraph)</span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb194-3"><a href="#cb194-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4"><a href="#cb194-4" aria-hidden="true" tabindex="-1"></a>nClumps <span class="ot">&lt;-</span> <span class="cf">function</span>(matrix){</span>
<span id="cb194-5"><a href="#cb194-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">return</span>(<span class="fu">max</span>(<span class="fu">as.matrix</span>(<span class="fu">clump</span>(<span class="fu">raster</span>(matrix), <span class="at">directions=</span><span class="dv">4</span>)), <span class="at">na.rm=</span><span class="cn">TRUE</span>))</span>
<span id="cb194-6"><a href="#cb194-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb194-7"><a href="#cb194-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-8"><a href="#cb194-8" aria-hidden="true" tabindex="-1"></a><span class="fu">nClumps</span>(obsData) <span class="sc">+</span> <span class="fu">nClumps</span>(<span class="dv">1</span><span class="sc">-</span>obsData)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 49</code></pre>
</div>
</div>
<p>Distribution of clump counts on data example 2</p>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-75_ac19fae77816eaeef6726dd4f58ef9ec">
<div class="sourceCode cell-code" id="cb196"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a>NMC <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb196-3"><a href="#cb196-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>NMC){</span>
<span id="cb196-4"><a href="#cb196-4" aria-hidden="true" tabindex="-1"></a>    shuffledMatrix <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data=</span><span class="fu">sample</span>(obsData2), <span class="at">nrow=</span><span class="fu">dim</span>(obsData2)[<span class="dv">1</span>], <span class="at">byrow=</span><span class="cn">TRUE</span>)</span>
<span id="cb196-5"><a href="#cb196-5" aria-hidden="true" tabindex="-1"></a>    results[i] <span class="ot">&lt;-</span> <span class="fu">nClumps</span>(shuffledMatrix) <span class="sc">+</span> <span class="fu">nClumps</span>(<span class="dv">1</span><span class="sc">-</span>shuffledMatrix)</span>
<span id="cb196-6"><a href="#cb196-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb196-7"><a href="#cb196-7" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(results)</span>
<span id="cb196-8"><a href="#cb196-8" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">nClumps</span>(obsData2)<span class="sc">+</span><span class="fu">nClumps</span>(<span class="dv">1</span><span class="sc">-</span>obsData2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="R05_testing_Additional_Examples_files/figure-html/unnamed-chunk-75-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nClumps</span>(obsData2)<span class="sc">+</span><span class="fu">nClumps</span>(<span class="dv">1</span><span class="sc">-</span>obsData2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 16</code></pre>
</div>
</div>
<p>How does counting clumps work on the first dataset?</p>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-76_bd718760369ccc49de6d7e56105c5ab3">
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a>NMC <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb199-2"><a href="#cb199-2" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb199-3"><a href="#cb199-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>NMC){</span>
<span id="cb199-4"><a href="#cb199-4" aria-hidden="true" tabindex="-1"></a>    shuffledMatrix <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data=</span><span class="fu">sample</span>(obsData), <span class="at">nrow=</span><span class="fu">dim</span>(obsData)[<span class="dv">1</span>], <span class="at">byrow=</span><span class="cn">TRUE</span>)</span>
<span id="cb199-5"><a href="#cb199-5" aria-hidden="true" tabindex="-1"></a>    results[i] <span class="ot">&lt;-</span> <span class="fu">nClumps</span>(shuffledMatrix)<span class="sc">+</span><span class="fu">nClumps</span>(<span class="dv">1</span><span class="sc">-</span>shuffledMatrix)</span>
<span id="cb199-6"><a href="#cb199-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb199-7"><a href="#cb199-7" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(results)</span>
<span id="cb199-8"><a href="#cb199-8" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">nClumps</span>(obsData)<span class="sc">+</span><span class="fu">nClumps</span>(<span class="dv">1</span><span class="sc">-</span>obsData))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="R05_testing_Additional_Examples_files/figure-html/unnamed-chunk-76-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb200"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nClumps</span>(obsData)<span class="sc">+</span><span class="fu">nClumps</span>(<span class="dv">1</span><span class="sc">-</span>obsData)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 49</code></pre>
</div>
</div>
</section>
<section id="test-statistic-6-variation-in-clump-sizes" class="level3" data-number="16.8.6">
<h3 data-number="16.8.6" class="anchored" data-anchor-id="test-statistic-6-variation-in-clump-sizes"><span class="header-section-number">16.8.6</span> Test Statistic 6: Variation in clump sizes</h3>
<p>Perhaps the standard deviation of the clump sizes might be useful.</p>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-77_a27ed613df6cef51cb645b390d5e6fa1">
<div class="sourceCode cell-code" id="cb202"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a>sdClumpSize <span class="ot">&lt;-</span> <span class="cf">function</span>(matrix){</span>
<span id="cb202-2"><a href="#cb202-2" aria-hidden="true" tabindex="-1"></a>  clumps1 <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">table</span>(<span class="fu">as.matrix</span>(<span class="fu">clump</span>(<span class="fu">raster</span>(matrix), <span class="at">directions=</span><span class="dv">4</span>))))</span>
<span id="cb202-3"><a href="#cb202-3" aria-hidden="true" tabindex="-1"></a>  clumps0 <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">table</span>(<span class="fu">as.matrix</span>(<span class="fu">clump</span>(<span class="fu">raster</span>(<span class="dv">1</span><span class="sc">-</span>matrix), <span class="at">directions=</span><span class="dv">4</span>))))</span>
<span id="cb202-4"><a href="#cb202-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">sd</span>(<span class="fu">c</span>(clumps0,clumps1)))</span>
<span id="cb202-5"><a href="#cb202-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="R05_testing_Additional_Examples_cache/html/unnamed-chunk-78_2413d960e3e288c97c806f66f6d4a7a2">
<div class="sourceCode cell-code" id="cb203"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a>NMC <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb203-2"><a href="#cb203-2" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb203-3"><a href="#cb203-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>NMC){</span>
<span id="cb203-4"><a href="#cb203-4" aria-hidden="true" tabindex="-1"></a>    shuffledMatrix <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data=</span><span class="fu">sample</span>(obsData), <span class="at">nrow=</span><span class="fu">dim</span>(obsData)[<span class="dv">1</span>], <span class="at">byrow=</span><span class="cn">TRUE</span>)</span>
<span id="cb203-5"><a href="#cb203-5" aria-hidden="true" tabindex="-1"></a>    results[i] <span class="ot">&lt;-</span> <span class="fu">sdClumpSize</span>(shuffledMatrix)</span>
<span id="cb203-6"><a href="#cb203-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb203-7"><a href="#cb203-7" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="R05_testing_Additional_Examples_files/figure-html/unnamed-chunk-78-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb204"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sdClumpSize</span>(obsData)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 10.27186</code></pre>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
  </div>
  <div class="nav-page nav-page-next">
      <a href="./testing2_practice.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Testing and Power Practice</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>